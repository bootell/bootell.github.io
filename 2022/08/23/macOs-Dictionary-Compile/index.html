<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> macOS Dictionary 词典编译 · BooTell</title><meta name="description" content="macOS Dictionary 词典编译 - Brooks Bao"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://bootell.net/atom.xml" title="BooTell"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="BooTell" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/bootell" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">macOS Dictionary 词典编译</h1><div class="post-info">2022-08-24<a class="post-tag" href="/tags/macOS/">#macOS</a></div><div class="post-content"><p>macOS 自带的 Dictionary.app 相比于其他词典应用，支持触摸板重按取词，十分方便。但自带词典随够用但较少，可以从其他词典转换成支持的词典，以丰富词库。<br>环境搭建及编译难度较小，重点在于各个词典的优化，以达到更加的显示效果。下面是整个词典制作的过程。</p>
<span id="more"></span>

<h3 id="环境部署"><a href="#环境部署" class="headerlink" title="环境部署"></a>环境部署</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://github.com/ilius/pyglossary/blob/master/doc/apple.md">pyglossary</a></p>
<h5 id="1-Python环境搭建"><a href="#1-Python环境搭建" class="headerlink" title="1. Python环境搭建"></a>1. Python环境搭建</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载项目</span></span><br><span class="line">git clone https://github.com/ilius/pyglossary.git</span><br><span class="line">cd pyglossary</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">python环境</span></span><br><span class="line">python3 -m venv venv</span><br><span class="line">source venv/bin/activate</span><br><span class="line">pip3 install lxml beautifulsoup4 html5lib</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">报错 <span class="string">&quot;LZO compression support is not available&quot;</span> 时安装</span></span><br><span class="line">brew install lzo</span><br><span class="line">pip3 install python-lzo</span><br></pre></td></tr></table></figure>

<h5 id="2-Apple-词典工具安装"><a href="#2-Apple-词典工具安装" class="headerlink" title="2. Apple 词典工具安装"></a>2. Apple 词典工具安装</h5><p>下载地址：<a target="_blank" rel="noopener" href="http://developer.apple.com/downloads">Additional Tools for Xcode</a><br>下载与自身 xcode 匹配的 “Additional Tools for Xcode”<br>将其中 <code>Utilities/Dictionary Development Kit</code> 解压放到 <code>/Applications/Utilities</code> 下</p>
<h5 id="3-音频转换需要安装speex"><a href="#3-音频转换需要安装speex" class="headerlink" title="3. 音频转换需要安装speex"></a>3. 音频转换需要安装speex</h5><p>brew直接安装的话，发现报错 “speexdec: command not found”,不带 bin 可执行文件，需要从源码编译 <a target="_blank" rel="noopener" href="https://github.com/ilius/pyglossary/issues/184">issues&#x2F;184</a><br>下载源码：<a target="_blank" rel="noopener" href="https://www.speex.org/downloads/">speex.org</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">报错 <span class="string">&quot;autoreconf: error: aclocal failed with exit status: 2&quot;</span>，需安装依赖</span></span><br><span class="line">brew install automake</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">报错 <span class="string">&quot;make[4]: Nothing to be done for `all&#x27;.&quot;</span>，安装依赖</span></span><br><span class="line">brew install pkg-config</span><br><span class="line"></span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>经测试，spx文件不需要转换，直接变更后缀为<code>.mp3</code>也可正常使用</p>
<h3 id="词典选择"><a href="#词典选择" class="headerlink" title="词典选择"></a>词典选择</h3><p>资源比较丰富且整理较好的有以下几个：</p>
<ul>
<li>牛津高阶英汉双解词典（第四版）&#x2F;（第八版）&#x2F;（第九版）&#x2F;（第十版）</li>
<li>朗文当代高级词典（第五版）</li>
<li>柯林斯COBUILD双解词典</li>
<li>韦氏高阶英汉双解词典</li>
</ul>
<p>资源获取的网站常用的有以下几个：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://freemdict.com/">https://freemdict.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.freemdict.com/c/12-category/12">https://forum.freemdict.com/c/12-category/12</a></li>
<li><a target="_blank" rel="noopener" href="https://www.pdawiki.com/forum/forum-4-1.html">https://www.pdawiki.com/forum/forum-4-1.html</a></li>
</ul>
<h3 id="转换过程"><a href="#转换过程" class="headerlink" title="转换过程"></a>转换过程</h3><h5 id="1-资源转换"><a href="#1-资源转换" class="headerlink" title="1. 资源转换"></a>1. 资源转换</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">移动资源文件</span></span><br><span class="line">mkdir dist</span><br><span class="line">mv &quot;~/Downloads/LDOCE 5++ V2.15&quot; ./dist/ldoce5</span><br><span class="line">cd dist/ldoce5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">转换为XML文件</span></span><br><span class="line">python3 ../../main.py --write-format=AppleDict &quot;LDOCE5++ V 2-15.mdx&quot; LDOCE5++</span><br><span class="line"></span><br><span class="line">cd LDOCE5++</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">转换音频</span></span><br><span class="line">find OtherResources -name &quot;*.spx&quot; -execdir sh -c &#x27;spx=&#123;&#125;;speexdec $spx  $&#123;spx%.*&#125;.wav&#x27; \;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">资源地址替换</span></span><br><span class="line">sed -i &quot;&quot; &#x27;s:src=&quot;/:src=&quot;:g&#x27; LDOCE5++.xml</span><br><span class="line">sed -i &quot;&quot; &#x27;s|sound://\([/_a-zA-Z0-9]*\).spx|\1.wav|g&#x27; LDOCE5++.xml</span><br></pre></td></tr></table></figure>

<p>将<code>LM5style.css</code>文件内容，替换到 <code>objects/LDOCE5++.dictionary/Contents/DefaultStyle.css</code></p>
<h5 id="2-优化"><a href="#2-优化" class="headerlink" title="2. 优化"></a>2. 优化</h5><p>为了让词典在 Dictionary.app 中显示效果更好，需要进行优化。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &quot;&quot; &quot;s|&gt; &lt;\/a&gt;|&gt;🔈&lt;/a&gt;|g&quot; LDOCE5.xml</span><br></pre></td></tr></table></figure>

<h5 id="3-编译与安装"><a href="#3-编译与安装" class="headerlink" title="3. 编译与安装"></a>3. 编译与安装</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>


<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>由于 Dictionary.app 自带牛津词典，这里转换朗文和柯林斯作为补充。</p>
<h5 id="1-LDOCE-5-V2-15"><a href="#1-LDOCE-5-V2-15" class="headerlink" title="1. LDOCE 5++ V2.15"></a>1. LDOCE 5++ V2.15</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">转换为XML文件</span></span><br><span class="line">python3 ../../main.py --write-format=AppleDict &quot;LDOCE5++ V 2-15.mdx&quot; LDOCE5</span><br><span class="line"></span><br><span class="line">cd LDOCE5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">转换音频，直接将后缀改为mp3</span></span><br><span class="line">find OtherResources -name &quot;*.spx&quot; -execdir sh -c &#x27;spx=&#123;&#125;;mv $spx $&#123;spx%.*&#125;.mp3&#x27; \;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">资源地址替换</span></span><br><span class="line">sed -i &quot;&quot; &#x27;s:src=&quot;/:src=&quot;:g&#x27; LDOCE5.xml</span><br><span class="line">sed -i &quot;&quot; &#x27;s|sound://\([/_a-zA-Z0-9]*\).spx|\1.mp3|g&#x27; LDOCE5.xml</span><br></pre></td></tr></table></figure>

<p>修改 <code>LDOCE5.plist</code><br>CFBundleDisplayName：朗文当代高级词典（第五版）<br>CFBundleName：朗文当代</p>
<p>将 <code>LM5style.css</code> 内容复制到 <code>LDOCE5.css</code>，并修改内容</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># 显示隐藏</span><br><span class="line"><span class="selector-class">.Sense</span> <span class="selector-class">.corpus</span> <span class="selector-class">.title</span> &#123;</span><br><span class="line">    <span class="comment">/* display: none; */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.LDOCEVERSION_new</span> <span class="selector-class">.BoxPanel</span> &#123;</span><br><span class="line">    <span class="comment">/* display: none; */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.dictionary_intro</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">    <span class="comment">/*background-color: #314089;*/</span></span><br><span class="line">    <span class="comment">/*color: #fff;*/</span></span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">5px</span> <span class="number">0</span> <span class="number">10px</span> -<span class="number">7px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wordfams</span> <span class="selector-class">.LDOCE5pp_sensefold</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.topics_container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 发音图标</span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;lm5pp_icomoon&#x27;</span>;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&quot;lm5pp_icomoon.ttf&quot;</span>);</span><br><span class="line">    <span class="attribute">font-weight</span>: normal;</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;cjkextent&#x27;</span>;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&quot;cjkextent.ttf&quot;</span>);</span><br><span class="line">    <span class="attribute">font-weight</span>: normal;</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2-CollinsCOBUILDOverhaul-v2-30"><a href="#2-CollinsCOBUILDOverhaul-v2-30" class="headerlink" title="2. CollinsCOBUILDOverhaul v2.30"></a>2. CollinsCOBUILDOverhaul v2.30</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">转换为XML文件</span></span><br><span class="line">python3 ../../main.py --write-format=AppleDict &quot;CollinsCOBUILDOverhaul V 2-30.mdx&quot; COLLINS</span><br><span class="line"></span><br><span class="line">cd COLLINS</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">资源地址替换</span></span><br><span class="line">sed -i &quot;&quot; &#x27;s:src=&quot;/:src=&quot;:g&#x27; COLLINS.xml</span><br></pre></td></tr></table></figure>

<p>修改 <code>COLLINS.plist</code><br>CFBundleDisplayName：柯林斯英汉双解词典<br>CFBundleName：柯林斯双解</p>
<p>自带CSS效果显示不好，这里查找到柯林斯完美复原版的样式文件，进行替换。将内容复制到 <code>COLLINS.css</code>，并修改内容</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 展开隐藏项</span><br><span class="line"><span class="selector-class">.hidden</span> &#123;</span><br><span class="line">    <span class="comment">/* display: none */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 隐藏单词用量</span><br><span class="line"><span class="selector-class">.trend</span><span class="selector-class">.folded</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 发音图标</span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;icomoon&#x27;</span>;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&quot;icomoon.ttf&quot;</span>);</span><br><span class="line">    <span class="attribute">font-weight</span>: normal;</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/ilius/pyglossary/blob/master/doc/apple.md">https://github.com/ilius/pyglossary/blob/master/doc/apple.md</a><br><a target="_blank" rel="noopener" href="https://kaihao.io/2018/mdict-to-macos-dictionary/">https://kaihao.io/2018/mdict-to-macos-dictionary/</a><br><a target="_blank" rel="noopener" href="https://10382.github.io/post/Mdict%E8%BD%ACMac%E8%AF%8D%E5%85%B8%E5%B0%8F%E8%AE%B0/">https://10382.github.io/post/Mdict转Mac词典小记/</a><br><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/20428599">https://www.zhihu.com/question/20428599</a><br><a target="_blank" rel="noopener" href="https://www.pdawiki.com/forum/thread-42822-1-1.html">https://www.pdawiki.com/forum/thread-42822-1-1.html</a><br><a target="_blank" rel="noopener" href="https://www.pdawiki.com/forum/thread-13014-1-1.html">https://www.pdawiki.com/forum/thread-13014-1-1.html</a><br><a target="_blank" rel="noopener" href="https://placeless.net/blog/macos-dictionaries">https://placeless.net/blog/macos-dictionaries</a><br><a target="_blank" rel="noopener" href="http://qunwang6.github.io/blog/OSXDictionary/">http://qunwang6.github.io/blog/OSXDictionary/</a><br><a target="_blank" rel="noopener" href="https://www.readern.com/convert-mdict-to-macos-dictionary.html">https://www.readern.com/convert-mdict-to-macos-dictionary.html</a></p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a class="next" href="/2020/08/13/PHP-Integrate-gRPC/">NEXT</a></div><div class="copyright"><p>© 2016 - 2022 <a href="https://bootell.net">Brooks Bao</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-111290368-1",'auto');ga('send','pageview');</script></body></html>