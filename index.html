<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> BooTell</title><meta name="description" content="Brooks's Blog"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://bootell.net/atom.xml" title="BooTell"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="BooTell" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link active" href="/" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/bootell" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li></ul></header><main class="container"><ul class="home post-list"><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a class="post-title-link" href="/2022/08/23/macOs-Dictionary-Compile/">macOS Dictionary 词典编译</a></h2><div class="post-info">2022-08-24<a class="post-tag" href="/tags/macOS/">#macOS</a></div><div class="post-content"><p>macOS 自带的 Dictionary.app 相比于其他词典应用，支持触摸板重按取词，十分方便。但自带词典随够用但较少，可以从其他词典转换成支持的词典，以丰富词库。<br>环境搭建及编译难度较小，重点在于各个词典的优化，以达到更加的显示效果。下面是整个词典制作的过程。</p></div><a class="read-more" href="/2022/08/23/macOs-Dictionary-Compile/">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a class="post-title-link" href="/2020/08/13/PHP-Integrate-gRPC/">PHP的gRPC客户端与服务端实践</a></h2><div class="post-info">2020-08-13<a class="post-tag" href="/tags/PHP/">#PHP</a></div><div class="post-content"><p>PHP 服务之间互相调用，有很多选择，可以通过 HTTP 接口，或者 RPC 像 <a target="_blank" rel="noopener" href="https://github.com/laruence/yar">yar</a>。考虑到今后多语言的扩展性与通用性，选取了 gRPC 作为方式。</p></div><a class="read-more" href="/2020/08/13/PHP-Integrate-gRPC/">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a class="post-title-link" href="/2020/07/18/SSH-Config-and-Usage/">SSH配置与使用</a></h2><div class="post-info">2020-07-18<a class="post-tag" href="/tags/Linux/">#Linux</a></div><div class="post-content"><h3 id="免密登录"><a href="#免密登录" class="headerlink" title="免密登录"></a>免密登录</h3><p>创建本地公私钥文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C &quot;youremail@example.com”</span><br></pre></td></tr></table></figure>

<p>生成后的文件在<code>~/.ssh</code>目录内，<code>id_rsa</code>为私钥，<code>id_rsa.pub</code>为公钥。将公钥复制到远程机器对应用户的<code>~/.ssh/authorized_keys</code>内。</p></div><a class="read-more" href="/2020/07/18/SSH-Config-and-Usage/">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a class="post-title-link" href="/2019/10/03/Build-Hexo-Using-Github-Actions/">自动化编译 Hexo 博客并部署在 Github Page</a></h2><div class="post-info">2019-10-03<a class="post-tag" href="/tags/Blog/">#Blog</a></div><div class="post-content"><p>一直使用 <a target="_blank" rel="noopener" href="https://travis-ci.org/">Travis CI</a> 来自动生成和部署 Hexo。最近 Github 推出了自己的持续集成服务 <a target="_blank" rel="noopener" href="https://github.com/features/actions">Github Actions</a>，于是改用它以方便管理。在此记录一下两种方法。</p></div><a class="read-more" href="/2019/10/03/Build-Hexo-Using-Github-Actions/">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a class="post-title-link" href="/2019/08/06/Scrapy-Development/">Scrapy 爬虫开发</a></h2><div class="post-info">2019-08-06<a class="post-tag" href="/tags/%E7%88%AC%E8%99%AB/">#爬虫</a></div><div class="post-content"><h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><p>Scrapy 支持 Python2.7 及 3.4+，安装步骤按照<a target="_blank" rel="noopener" href="https://docs.scrapy.org/en/latest/intro/install.html">官方文档</a>进行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">pip3 install Scrapy</span><br><span class="line"><span class="comment"># 创建项目</span></span><br><span class="line">scrapy startproject crawler</span><br></pre></td></tr></table></figure>


<p>安装完毕后，目录结构如下所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">crawler/</span><br><span class="line">    scrapy.cfg            # scrapyd-client 项目部署时使用</span><br><span class="line">    crawler/</span><br><span class="line">        __init__.py</span><br><span class="line">        items.py          # 爬取结果结构化</span><br><span class="line">        middlewares.py    # 项目中间件</span><br><span class="line">        pipelines.py      # 项目管道</span><br><span class="line">        settings.py       # 项目设置</span><br><span class="line">        spiders/          # 爬虫所在目录</span><br><span class="line">            __init__.py</span><br></pre></td></tr></table></figure>


<p>Scrapy 执行时的流程大致是</p>
<p><img src="/images/scrapy_flow.png" alt="Scrapy 流程"></p>
<ol>
<li>Engine 从 Spider 获取 <code>start_urls</code></li>
<li>Engine 将 <code>start_urls</code> 发送到 Scheduler，并请求下一个爬取的 Request</li>
<li>Scheduler 将下一个要爬取 Request 返回给 Engine</li>
<li>Engine 将收到的 Request 执行所有 Middleware 的 <code>process_request()</code> 后，发送到 Downloader</li>
<li>Downloader 下载内容后，执行所有 Middleware 的 <code>process_response()</code> 后，将结果返回给 Engine</li>
<li>Engine 将内容发送给 Spider 做数据处理，之前执行 Middleware 的 <code>process_spider_input()</code></li>
<li>Spider 处理后，将结果通过 Middleware 的 <code>process_spider_output()</code> 后，返回给 Engine</li>
<li>Engine 将处理后的数据发送给 Pipline 进行操作，并将处理过的 Request 发送给 Scheduler，请求下一个 Request</li>
</ol>
<p><code>settings.py</code> 配置文件中，一般需要修改的配置如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 是否遵循 robots 协议</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span></span><br><span class="line"><span class="comment"># 并发请求数</span></span><br><span class="line">CONCURRENT_REQUESTS = <span class="number">16</span></span><br><span class="line"><span class="comment"># 下载间隔，实际范围在 0.5*DOWNLOAD_DELAY 到 1.5*DOWNLOAD_DELAY 之间</span></span><br><span class="line">DOWNLOAD_DELAY = <span class="number">1</span></span><br><span class="line"><span class="comment"># 域名/IP 并发请求限制</span></span><br><span class="line">CONCURRENT_REQUESTS_PER_DOMAIN = <span class="number">16</span></span><br><span class="line">CONCURRENT_REQUESTS_PER_IP = <span class="number">16</span></span><br><span class="line"><span class="comment"># 启用 Cookies</span></span><br><span class="line">COOKIES_ENABLED = <span class="literal">False</span></span><br><span class="line"><span class="comment"># 下载中间件，后面数字表示优先级</span></span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;&#125;</span><br><span class="line"><span class="comment"># 管道</span></span><br><span class="line">ITEM_PIPELINES = &#123;&#125;</span><br></pre></td></tr></table></figure></div><a class="read-more" href="/2019/08/06/Scrapy-Development/">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a class="post-title-link" href="/2019/02/28/LEDE-K3-Build-with-GitLab-CI/">自动化编译 LEDE K3</a></h2><div class="post-info">2019-02-28<a class="post-tag" href="/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/">#路由器</a></div><div class="post-content"><p>本地编译一次 LEDE&#x2F;OpenWrt 固件花了近3个小时，下载依赖文件因为网络问题也比较慢，考虑可以利用各种免费的 CI 自动集成工具来编译需要的固件，目前可选的有 Github Actions 和 GitLab CI。</p></div><a class="read-more" href="/2019/02/28/LEDE-K3-Build-with-GitLab-CI/">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a class="post-title-link" href="/2018/08/30/Paypay-Subscriptions-Integrate/">Paypal 实现自动订阅</a></h2><div class="post-info">2018-08-30<a class="post-tag" href="/tags/PHP/">#PHP</a></div><div class="post-content"><p>官方给出的自动续费分五步 <a target="_blank" rel="noopener" href="https://developer.paypal.com/docs/subscriptions/integrate/integrate-steps/">Intergrate Subscriptions</a>。实际开发中，还需要实现支付结果处理和订阅管理等：</p>
<ol>
<li>事先创建计划，并激活；</li>
<li>用户创建订阅，跳转到paypal网站等待用户同意；</li>
<li>用户同意后，跳转回网站，执行订阅；</li>
<li>获取用户账单，包括每次扣款结果通知的接收或支付结果的主动查询；</li>
<li>处理用户取消订阅等通知。</li>
</ol></div><a class="read-more" href="/2018/08/30/Paypay-Subscriptions-Integrate/">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a class="post-title-link" href="/2016/02/01/Hello-World/">Hello World</a></h2><div class="post-info">2016-02-01</div><div class="post-content"><p>2016, 从校园到社会, 从接收学习到发出声音.</p>
<p>记录积累, 在这里, boot to tell.</p></div><a class="read-more" href="/2016/02/01/Hello-World/">...more</a></article></li></ul></main><footer><div class="paginator"></div><div class="copyright"><p>© 2016 - 2022 <a href="https://bootell.net">Brooks Bao</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-111290368-1",'auto');ga('send','pageview');</script></body></html>