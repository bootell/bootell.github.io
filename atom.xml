<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>BooTell</title>
  
  <subtitle>Compute and Communicate</subtitle>
  <link href="https://bootell.net/atom.xml" rel="self"/>
  
  <link href="https://bootell.net/"/>
  <updated>2022-09-11T14:34:52.494Z</updated>
  <id>https://bootell.net/</id>
  
  <author>
    <name>Brooks Bao</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>macOS Dictionary è¯å…¸ç¼–è¯‘</title>
    <link href="https://bootell.net/2022/08/23/macOs-Dictionary-Compile/"/>
    <id>https://bootell.net/2022/08/23/macOs-Dictionary-Compile/</id>
    <published>2022-08-23T16:15:00.000Z</published>
    <updated>2022-09-11T14:34:52.494Z</updated>
    
    <content type="html"><![CDATA[<p>macOS è‡ªå¸¦çš„ Dictionary.app ç›¸æ¯”äºå…¶ä»–è¯å…¸åº”ç”¨ï¼Œæ”¯æŒè§¦æ‘¸æ¿é‡æŒ‰å–è¯ï¼Œååˆ†æ–¹ä¾¿ã€‚ä½†è‡ªå¸¦è¯å…¸éšå¤Ÿç”¨ä½†è¾ƒå°‘ï¼Œå¯ä»¥ä»å…¶ä»–è¯å…¸è½¬æ¢æˆæ”¯æŒçš„è¯å…¸ï¼Œä»¥ä¸°å¯Œè¯åº“ã€‚<br>ç¯å¢ƒæ­å»ºåŠç¼–è¯‘éš¾åº¦è¾ƒå°ï¼Œé‡ç‚¹åœ¨äºå„ä¸ªè¯å…¸çš„ä¼˜åŒ–ï¼Œä»¥è¾¾åˆ°æ›´åŠ çš„æ˜¾ç¤ºæ•ˆæœã€‚ä¸‹é¢æ˜¯æ•´ä¸ªè¯å…¸åˆ¶ä½œçš„è¿‡ç¨‹ã€‚</p><span id="more"></span><h3 id="ç¯å¢ƒéƒ¨ç½²"><a href="#ç¯å¢ƒéƒ¨ç½²" class="headerlink" title="ç¯å¢ƒéƒ¨ç½²"></a>ç¯å¢ƒéƒ¨ç½²</h3><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://github.com/ilius/pyglossary/blob/master/doc/apple.md">pyglossary</a></p><h5 id="1-Pythonç¯å¢ƒæ­å»º"><a href="#1-Pythonç¯å¢ƒæ­å»º" class="headerlink" title="1. Pythonç¯å¢ƒæ­å»º"></a>1. Pythonç¯å¢ƒæ­å»º</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸‹è½½é¡¹ç›®</span></span><br><span class="line">git cloneÂ https://github.com/ilius/pyglossary.git</span><br><span class="line">cdÂ pyglossary</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pythonç¯å¢ƒ</span></span><br><span class="line">python3 -m venv venv</span><br><span class="line">source venv/bin/activate</span><br><span class="line">pip3 install lxml beautifulsoup4 html5lib</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ¥é”™ <span class="string">&quot;LZO compression support is not available&quot;</span> æ—¶å®‰è£…</span></span><br><span class="line">brew install lzo</span><br><span class="line">pip3 install python-lzo</span><br></pre></td></tr></table></figure><h5 id="2-Apple-è¯å…¸å·¥å…·å®‰è£…"><a href="#2-Apple-è¯å…¸å·¥å…·å®‰è£…" class="headerlink" title="2. Apple è¯å…¸å·¥å…·å®‰è£…"></a>2. Apple è¯å…¸å·¥å…·å®‰è£…</h5><p>ä¸‹è½½åœ°å€ï¼š<a href="http://developer.apple.com/downloads">Additional Tools for Xcode</a><br>ä¸‹è½½ä¸è‡ªèº« xcode åŒ¹é…çš„ â€œAdditional Tools for Xcodeâ€<br>å°†å…¶ä¸­ <code>Utilities/Dictionary Development Kit</code> è§£å‹æ”¾åˆ° <code>/Applications/Utilities</code> ä¸‹</p><h5 id="3-éŸ³é¢‘è½¬æ¢éœ€è¦å®‰è£…speex"><a href="#3-éŸ³é¢‘è½¬æ¢éœ€è¦å®‰è£…speex" class="headerlink" title="3. éŸ³é¢‘è½¬æ¢éœ€è¦å®‰è£…speex"></a>3. éŸ³é¢‘è½¬æ¢éœ€è¦å®‰è£…speex</h5><p>brewç›´æ¥å®‰è£…çš„è¯ï¼Œå‘ç°æŠ¥é”™ â€œspeexdec: command not foundâ€,ä¸å¸¦ bin å¯æ‰§è¡Œæ–‡ä»¶ï¼Œéœ€è¦ä»æºç ç¼–è¯‘ <a href="https://github.com/ilius/pyglossary/issues/184">issues&#x2F;184</a><br>ä¸‹è½½æºç ï¼š<a href="https://www.speex.org/downloads/">speex.org</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ¥é”™ <span class="string">&quot;autoreconf: error: aclocal failed with exit status: 2&quot;</span>ï¼Œéœ€å®‰è£…ä¾èµ–</span></span><br><span class="line">brew install automake</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ¥é”™ <span class="string">&quot;make[4]: Nothing to be done for `all&#x27;.&quot;</span>ï¼Œå®‰è£…ä¾èµ–</span></span><br><span class="line">brew installÂ pkg-config</span><br><span class="line"></span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>ç»æµ‹è¯•ï¼Œspxæ–‡ä»¶ä¸éœ€è¦è½¬æ¢ï¼Œç›´æ¥å˜æ›´åç¼€ä¸º<code>.mp3</code>ä¹Ÿå¯æ­£å¸¸ä½¿ç”¨</p><h3 id="è¯å…¸é€‰æ‹©"><a href="#è¯å…¸é€‰æ‹©" class="headerlink" title="è¯å…¸é€‰æ‹©"></a>è¯å…¸é€‰æ‹©</h3><p>èµ„æºæ¯”è¾ƒä¸°å¯Œä¸”æ•´ç†è¾ƒå¥½çš„æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li>ç‰›æ´¥é«˜é˜¶è‹±æ±‰åŒè§£è¯å…¸ï¼ˆç¬¬å››ç‰ˆï¼‰&#x2F;ï¼ˆç¬¬å…«ç‰ˆï¼‰&#x2F;ï¼ˆç¬¬ä¹ç‰ˆï¼‰&#x2F;ï¼ˆç¬¬åç‰ˆï¼‰</li><li>æœ—æ–‡å½“ä»£é«˜çº§è¯å…¸ï¼ˆç¬¬äº”ç‰ˆï¼‰</li><li>æŸ¯æ—æ–¯COBUILDåŒè§£è¯å…¸</li><li>éŸ¦æ°é«˜é˜¶è‹±æ±‰åŒè§£è¯å…¸</li></ul><p>èµ„æºè·å–çš„ç½‘ç«™å¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li><a href="https://freemdict.com/">https://freemdict.com/</a></li><li><a href="https://forum.freemdict.com/c/12-category/12">https://forum.freemdict.com/c/12-category/12</a></li><li><a href="https://www.pdawiki.com/forum/forum-4-1.html">https://www.pdawiki.com/forum/forum-4-1.html</a></li></ul><h3 id="è½¬æ¢è¿‡ç¨‹"><a href="#è½¬æ¢è¿‡ç¨‹" class="headerlink" title="è½¬æ¢è¿‡ç¨‹"></a>è½¬æ¢è¿‡ç¨‹</h3><h5 id="1-èµ„æºè½¬æ¢"><a href="#1-èµ„æºè½¬æ¢" class="headerlink" title="1. èµ„æºè½¬æ¢"></a>1. èµ„æºè½¬æ¢</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç§»åŠ¨èµ„æºæ–‡ä»¶</span></span><br><span class="line">mkdir dist</span><br><span class="line">mv &quot;~/Downloads/LDOCE 5++ V2.15&quot;Â ./dist/ldoce5</span><br><span class="line">cdÂ dist/ldoce5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è½¬æ¢ä¸ºXMLæ–‡ä»¶</span></span><br><span class="line">python3 ../../main.py --write-format=AppleDict &quot;LDOCE5++ V 2-15.mdx&quot; LDOCE5++</span><br><span class="line"></span><br><span class="line">cdÂ LDOCE5++</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è½¬æ¢éŸ³é¢‘</span></span><br><span class="line">find OtherResources -name &quot;*.spx&quot; -execdir sh -c &#x27;spx=&#123;&#125;;speexdec $spx  $&#123;spx%.*&#125;.wav&#x27; \;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">èµ„æºåœ°å€æ›¿æ¢</span></span><br><span class="line">sed -i &quot;&quot; &#x27;s:src=&quot;/:src=&quot;:g&#x27;Â LDOCE5++.xml</span><br><span class="line">sed -i &quot;&quot; &#x27;s|sound://\([/_a-zA-Z0-9]*\).spx|\1.wav|g&#x27;Â LDOCE5++.xml</span><br></pre></td></tr></table></figure><p>å°†<code>LM5style.css</code>æ–‡ä»¶å†…å®¹ï¼Œæ›¿æ¢åˆ° <code>objects/LDOCE5++.dictionary/Contents/DefaultStyle.css</code></p><h5 id="2-ä¼˜åŒ–"><a href="#2-ä¼˜åŒ–" class="headerlink" title="2. ä¼˜åŒ–"></a>2. ä¼˜åŒ–</h5><p>ä¸ºäº†è®©è¯å…¸åœ¨ Dictionary.app ä¸­æ˜¾ç¤ºæ•ˆæœæ›´å¥½ï¼Œéœ€è¦è¿›è¡Œä¼˜åŒ–ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &quot;&quot; &quot;s|&gt;Â &lt;\/a&gt;|&gt;ğŸ”ˆ&lt;/a&gt;|g&quot; LDOCE5.xml</span><br></pre></td></tr></table></figure><h5 id="3-ç¼–è¯‘ä¸å®‰è£…"><a href="#3-ç¼–è¯‘ä¸å®‰è£…" class="headerlink" title="3. ç¼–è¯‘ä¸å®‰è£…"></a>3. ç¼–è¯‘ä¸å®‰è£…</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>ç”±äº Dictionary.app è‡ªå¸¦ç‰›æ´¥è¯å…¸ï¼Œè¿™é‡Œè½¬æ¢æœ—æ–‡å’ŒæŸ¯æ—æ–¯ä½œä¸ºè¡¥å……ã€‚</p><h5 id="1-LDOCE-5-V2-15"><a href="#1-LDOCE-5-V2-15" class="headerlink" title="1. LDOCE 5++ V2.15"></a>1. LDOCE 5++ V2.15</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è½¬æ¢ä¸ºXMLæ–‡ä»¶</span></span><br><span class="line">python3 ../../main.py --write-format=AppleDict &quot;LDOCE5++ V 2-15.mdx&quot; LDOCE5</span><br><span class="line"></span><br><span class="line">cdÂ LDOCE5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è½¬æ¢éŸ³é¢‘ï¼Œç›´æ¥å°†åç¼€æ”¹ä¸ºmp3</span></span><br><span class="line">find OtherResources -name &quot;*.spx&quot; -execdir sh -c &#x27;spx=&#123;&#125;;mv $spx $&#123;spx%.*&#125;.mp3&#x27; \;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">èµ„æºåœ°å€æ›¿æ¢</span></span><br><span class="line">sed -i &quot;&quot; &#x27;s:src=&quot;/:src=&quot;:g&#x27; LDOCE5.xml</span><br><span class="line">sed -i &quot;&quot; &#x27;s|sound://\([/_a-zA-Z0-9]*\).spx|\1.mp3|g&#x27;Â LDOCE5.xml</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>LDOCE5.plist</code><br>CFBundleDisplayNameï¼šæœ—æ–‡å½“ä»£é«˜çº§è¯å…¸ï¼ˆç¬¬äº”ç‰ˆï¼‰<br>CFBundleNameï¼šæœ—æ–‡å½“ä»£</p><p>å°† <code>LM5style.css</code> å†…å®¹å¤åˆ¶åˆ° <code>LDOCE5.css</code>ï¼Œå¹¶ä¿®æ”¹å†…å®¹</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># æ˜¾ç¤ºéšè—</span><br><span class="line"><span class="selector-class">.Sense</span> <span class="selector-class">.corpus</span> <span class="selector-class">.title</span> &#123;</span><br><span class="line">    <span class="comment">/* display: none; */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.LDOCEVERSION_new</span> <span class="selector-class">.BoxPanel</span> &#123;</span><br><span class="line">    <span class="comment">/* display: none; */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.dictionary_intro</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">    <span class="comment">/*background-color: #314089;*/</span></span><br><span class="line">    <span class="comment">/*color: #fff;*/</span></span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">5px</span> <span class="number">0</span> <span class="number">10px</span> -<span class="number">7px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wordfams</span> <span class="selector-class">.LDOCE5pp_sensefold</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.topics_container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># å‘éŸ³å›¾æ ‡</span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;lm5pp_icomoon&#x27;</span>;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&quot;lm5pp_icomoon.ttf&quot;</span>);</span><br><span class="line">    <span class="attribute">font-weight</span>: normal;</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;cjkextent&#x27;</span>;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&quot;cjkextent.ttf&quot;</span>);</span><br><span class="line">    <span class="attribute">font-weight</span>: normal;</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2-CollinsCOBUILDOverhaul-v2-30"><a href="#2-CollinsCOBUILDOverhaul-v2-30" class="headerlink" title="2. CollinsCOBUILDOverhaul v2.30"></a>2. CollinsCOBUILDOverhaul v2.30</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è½¬æ¢ä¸ºXMLæ–‡ä»¶</span></span><br><span class="line">python3 ../../main.py --write-format=AppleDict &quot;CollinsCOBUILDOverhaul V 2-30.mdx&quot; COLLINS</span><br><span class="line"></span><br><span class="line">cdÂ COLLINS</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">èµ„æºåœ°å€æ›¿æ¢</span></span><br><span class="line">sed -i &quot;&quot; &#x27;s:src=&quot;/:src=&quot;:g&#x27; COLLINS.xml</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>COLLINS.plist</code><br>CFBundleDisplayNameï¼šæŸ¯æ—æ–¯è‹±æ±‰åŒè§£è¯å…¸<br>CFBundleNameï¼šæŸ¯æ—æ–¯åŒè§£</p><p>è‡ªå¸¦CSSæ•ˆæœæ˜¾ç¤ºä¸å¥½ï¼Œè¿™é‡ŒæŸ¥æ‰¾åˆ°æŸ¯æ—æ–¯å®Œç¾å¤åŸç‰ˆçš„æ ·å¼æ–‡ä»¶ï¼Œè¿›è¡Œæ›¿æ¢ã€‚å°†å†…å®¹å¤åˆ¶åˆ° <code>COLLINS.css</code>ï¼Œå¹¶ä¿®æ”¹å†…å®¹</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># å±•å¼€éšè—é¡¹</span><br><span class="line"><span class="selector-class">.hidden</span> &#123;</span><br><span class="line">    <span class="comment">/* display: none */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># éšè—å•è¯ç”¨é‡</span><br><span class="line"><span class="selector-class">.trend</span><span class="selector-class">.folded</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># å‘éŸ³å›¾æ ‡</span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;icomoon&#x27;</span>;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&quot;icomoon.ttf&quot;</span>);</span><br><span class="line">    <span class="attribute">font-weight</span>: normal;</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><blockquote><p><a href="https://github.com/ilius/pyglossary/blob/master/doc/apple.md">https://github.com/ilius/pyglossary/blob/master/doc/apple.md</a><br><a href="https://kaihao.io/2018/mdict-to-macos-dictionary/">https://kaihao.io/2018/mdict-to-macos-dictionary/</a><br><a href="https://10382.github.io/post/Mdict%E8%BD%ACMac%E8%AF%8D%E5%85%B8%E5%B0%8F%E8%AE%B0/">https://10382.github.io/post/Mdictè½¬Macè¯å…¸å°è®°/</a><br><a href="https://www.zhihu.com/question/20428599">https://www.zhihu.com/question/20428599</a><br><a href="https://www.pdawiki.com/forum/thread-42822-1-1.html">https://www.pdawiki.com/forum/thread-42822-1-1.html</a><br><a href="https://www.pdawiki.com/forum/thread-13014-1-1.html">https://www.pdawiki.com/forum/thread-13014-1-1.html</a><br><a href="https://placeless.net/blog/macos-dictionaries">https://placeless.net/blog/macos-dictionaries</a><br><a href="http://qunwang6.github.io/blog/OSXDictionary/">http://qunwang6.github.io/blog/OSXDictionary/</a><br><a href="https://www.readern.com/convert-mdict-to-macos-dictionary.html">https://www.readern.com/convert-mdict-to-macos-dictionary.html</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;macOS è‡ªå¸¦çš„ Dictionary.app ç›¸æ¯”äºå…¶ä»–è¯å…¸åº”ç”¨ï¼Œæ”¯æŒè§¦æ‘¸æ¿é‡æŒ‰å–è¯ï¼Œååˆ†æ–¹ä¾¿ã€‚ä½†è‡ªå¸¦è¯å…¸éšå¤Ÿç”¨ä½†è¾ƒå°‘ï¼Œå¯ä»¥ä»å…¶ä»–è¯å…¸è½¬æ¢æˆæ”¯æŒçš„è¯å…¸ï¼Œä»¥ä¸°å¯Œè¯åº“ã€‚&lt;br&gt;ç¯å¢ƒæ­å»ºåŠç¼–è¯‘éš¾åº¦è¾ƒå°ï¼Œé‡ç‚¹åœ¨äºå„ä¸ªè¯å…¸çš„ä¼˜åŒ–ï¼Œä»¥è¾¾åˆ°æ›´åŠ çš„æ˜¾ç¤ºæ•ˆæœã€‚ä¸‹é¢æ˜¯æ•´ä¸ªè¯å…¸åˆ¶ä½œçš„è¿‡ç¨‹ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="macOS" scheme="https://bootell.net/tags/macOS/"/>
    
  </entry>
  
  <entry>
    <title>PHPçš„gRPCå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å®è·µ</title>
    <link href="https://bootell.net/2020/08/13/PHP-Integrate-gRPC/"/>
    <id>https://bootell.net/2020/08/13/PHP-Integrate-gRPC/</id>
    <published>2020-08-13T03:14:00.000Z</published>
    <updated>2020-08-13T03:14:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>PHP æœåŠ¡ä¹‹é—´äº’ç›¸è°ƒç”¨ï¼Œæœ‰å¾ˆå¤šé€‰æ‹©ï¼Œå¯ä»¥é€šè¿‡ HTTP æ¥å£ï¼Œæˆ–è€… RPC åƒ <a href="https://github.com/laruence/yar">yar</a>ã€‚è€ƒè™‘åˆ°ä»Šåå¤šè¯­è¨€çš„æ‰©å±•æ€§ä¸é€šç”¨æ€§ï¼Œé€‰å–äº† gRPC ä½œä¸ºæ–¹å¼ã€‚</p><span id="more"></span><h3 id="gRPCé€šä¿¡"><a href="#gRPCé€šä¿¡" class="headerlink" title="gRPCé€šä¿¡"></a>gRPCé€šä¿¡</h3><p>gRPC æ˜¯ä¸€ç§å¯åœ¨ä»»ä½•ç¯å¢ƒä¸­è¿è¡Œçš„ç°ä»£å¼€æºé«˜æ€§èƒ½ RPC æ¡†æ¶ï¼Œå¯ä»¥åƒè°ƒç”¨æœ¬åœ°å¯¹è±¡ä¸€æ ·ç›´æ¥è°ƒç”¨å¦ä¸€å°ä¸åŒçš„æœºå™¨ä¸ŠæœåŠ¡ç«¯åº”ç”¨çš„æ–¹æ³•ã€‚</p><p>å¯¹æ¯”ä¹‹å‰é€šè¿‡ HTTP ä½¿ç”¨ Json æ ¼å¼å‘é€æ•°æ®ï¼Œè¯´æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>ä½¿ç”¨ <code>*.proto</code> æ–‡ä»¶ç”Ÿæˆç›¸å…³ä»£ç ï¼Œæ ¼å¼æ›´è§„èŒƒï¼Œè¿‡ç¨‹è°ƒç”¨ç®€åŒ–æ“ä½œï¼Œä¸ä¼šå—åˆ° HTTP èµ„æºæ–¹æ³•è¯­ä¹‰çš„é™åˆ¶ï¼›</li><li>ä½¿ç”¨ Protobuf ç¼–è¯‘æˆäºŒè¿›åˆ¶ï¼Œåœ¨ç¼–ç»„é€Ÿåº¦å’Œä»£ç å¤§å°æ–¹é¢æä¾›äº†æ›´é«˜æ•ˆçš„æ•°æ®äº¤æ¢ï¼›</li><li>é€šè¿‡ HTTP&#x2F;2 è¿›è¡Œé«˜æ•ˆç½‘ç»œä¼ è¾“ï¼Œå¼•å…¥åŒå‘æµå¼ä¼ è¾“ã€æµæ§åˆ¶ã€æŠ¥å¤´å‹ç¼©ç­‰ï¼Œå‡å°‘èµ„æºä½¿ç”¨é‡ï¼Œä»è€Œç¼©çŸ­åº”ç”¨ä¸æœåŠ¡ä¹‹é—´çš„å“åº”æ—¶é—´ã€‚</li></ul><p>gRPC å…è®¸å››ç§æ–¹æ³•ï¼š</p><ul><li>å•å‘ï¼Œå³å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ç»™æœåŠ¡ç«¯ï¼Œä»æœåŠ¡ç«¯è·å–ä¸€ä¸ªåº”ç­”</li><li>æœåŠ¡ç«¯æµå¼ï¼Œå³å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ç»™æœåŠ¡ç«¯ï¼Œå¯è·å–ä¸€ä¸ªæ•°æ®æµç”¨æ¥è¯»å–ä¸€ç³»åˆ—æ¶ˆæ¯</li><li>å®¢æˆ·ç«¯æµå¼ï¼Œå³å®¢æˆ·ç«¯ç”¨æä¾›çš„ä¸€ä¸ªæ•°æ®æµå†™å…¥å¹¶å‘é€ä¸€ç³»åˆ—æ¶ˆæ¯ç»™æœåŠ¡ç«¯</li><li>åŒå‘æµå¼ï¼Œå³ä¸¤è¾¹éƒ½å¯ä»¥åˆ†åˆ«é€šè¿‡ä¸€ä¸ªè¯»å†™æ•°æ®æµæ¥å‘é€ä¸€ç³»åˆ—æ¶ˆæ¯</li></ul><p>è‹¥ä½¿ç”¨fpmæ¨¡å¼è¿è¡ŒPHPï¼Œæš‚æ—¶åªèƒ½æ–¹ä¾¿å®ç°å•å‘ RPCã€‚</p><h3 id="gRPCç¯å¢ƒé…ç½®"><a href="#gRPCç¯å¢ƒé…ç½®" class="headerlink" title="gRPCç¯å¢ƒé…ç½®"></a>gRPCç¯å¢ƒé…ç½®</h3><p>PHP å®‰è£… gRPC æ”¯æŒï¼Œå‚è€ƒæ–‡æ¡£ï¼š<a href="https://grpc.io/docs/languages/php/quickstart/">Quick Start - grpc.io</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£…æ‰©å±•ï¼Œæœ‰ pecl å’Œ composerï¼Œä¸¤ç§æ–¹å¼ï¼Œpecl æ€§èƒ½æ›´å¥½</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gRPCæ‰©å±•</span></span><br><span class="line">pecl install grpc</span><br><span class="line">composer require grpc/grpc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Protobufæ‰©å±•</span></span><br><span class="line">pecl install protobuf</span><br><span class="line">composer require google/protobuf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">protocç¼–è¯‘å™¨ä¸‹è½½</span></span><br><span class="line">curl --fail -L -O https://github.com/protocolbuffers/protobuf/releases/download/v3.12.4/protoc-3.12.4-linux-x86_64.zip</span><br><span class="line">unzip protoc-3.12.4-linux-x86_64.zip &#x27;bin/protoc&#x27; -d /usr/local</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¯‘å™¨ç”Ÿæˆphpç»„ä»¶</span></span><br><span class="line">apt-get install automake libtool</span><br><span class="line">git clone -b v1.31.0 https://github.com/grpc/grpc</span><br><span class="line">cd grpc &amp;&amp; git submodule update --init</span><br><span class="line">make grpc_php_plugin</span><br><span class="line">mv bins/opt/grpc_php_plugin /usr/local/bin</span><br></pre></td></tr></table></figure><h3 id="gRPC-ä½¿ç”¨"><a href="#gRPC-ä½¿ç”¨" class="headerlink" title="gRPC ä½¿ç”¨"></a>gRPC ä½¿ç”¨</h3><p>ç¼–å†™ <code>Hello.proto</code> æ–‡ä»¶</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">package</span> test;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// The greeting service definition.</span></span><br><span class="line"><span class="keyword">service </span><span class="title class_">Hello</span> &#123;</span><br><span class="line">  <span class="comment">// Sends a greeting</span></span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> SayHello (HelloRequest) <span class="keyword">returns</span> (HelloResponse) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// The request message containing the user&#x27;s name.</span></span><br><span class="line"><span class="keyword">message </span><span class="title class_">HelloRequest</span> &#123;</span><br><span class="line">  <span class="type">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// The response message containing the greetings</span></span><br><span class="line"><span class="keyword">message </span><span class="title class_">HelloResponse</span> &#123;</span><br><span class="line">  <span class="type">string</span> message = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ php æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc -I ./protos_dir --php_out=./php_dir --grpc_out=./GPBMetadata_dir --plugin=protoc-gen-grpc=$(which grpc_php_plugin) $file</span><br></pre></td></tr></table></figure><p>ç”±äºç”Ÿæˆçš„æ–‡ä»¶å‘½åç©ºé—´éƒ½æ˜¯æ ¹ç›®å½•ï¼Œæ‰€ä»¥éœ€è¦åœ¨ <code>composer.json</code> ä¸­æ·»åŠ è‡ªåŠ¨åŠ è½½ï¼Œç„¶åæ‰§è¡Œ <code>composer dump-autoload</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;autoload&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;psr-4&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;GPBMetadata\\&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GPBMetadata_dir/GPBMetadata&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Test\\&quot;</span><span class="punctuation">:</span> <span class="string">&quot;php_dir/Test&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>Nginx å¯¹ gRPCçš„æ”¯æŒï¼Œå‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.nginx.com/blog/nginx-1-13-10-grpc/">gRPC Support with NGINX</a></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8000</span> http2;</span><br><span class="line">    <span class="attribute">server_name</span> grpc.localhost;</span><br><span class="line">    <span class="attribute">index</span> index.php;ã€</span><br><span class="line">    <span class="attribute">root</span> /var/www/grpc;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">add_trailer</span> grpc-status <span class="variable">$sent_http_grpc_status</span>;</span><br><span class="line">    <span class="attribute">add_trailer</span> grpc-message <span class="variable">$sent_http_grpc_message</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php<span class="variable">$is_args</span><span class="variable">$args</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">        <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> php-fpm:<span class="number">9000</span>;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ yii2 æ¡†æ¶å®ç°çš„å®Œæ•´ä¾‹å­ï¼š<a href="https://github.com/bootell/yii2-grpc-demo">bootell&#x2F;yii2-grpc-demo</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;PHP æœåŠ¡ä¹‹é—´äº’ç›¸è°ƒç”¨ï¼Œæœ‰å¾ˆå¤šé€‰æ‹©ï¼Œå¯ä»¥é€šè¿‡ HTTP æ¥å£ï¼Œæˆ–è€… RPC åƒ &lt;a href=&quot;https://github.com/laruence/yar&quot;&gt;yar&lt;/a&gt;ã€‚è€ƒè™‘åˆ°ä»Šåå¤šè¯­è¨€çš„æ‰©å±•æ€§ä¸é€šç”¨æ€§ï¼Œé€‰å–äº† gRPC ä½œä¸ºæ–¹å¼ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="PHP" scheme="https://bootell.net/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>SSHé…ç½®ä¸ä½¿ç”¨</title>
    <link href="https://bootell.net/2020/07/18/SSH-Config-and-Usage/"/>
    <id>https://bootell.net/2020/07/18/SSH-Config-and-Usage/</id>
    <published>2020-07-18T02:28:00.000Z</published>
    <updated>2020-07-18T02:28:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å…å¯†ç™»å½•"><a href="#å…å¯†ç™»å½•" class="headerlink" title="å…å¯†ç™»å½•"></a>å…å¯†ç™»å½•</h3><p>åˆ›å»ºæœ¬åœ°å…¬ç§é’¥æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C &quot;youremail@example.comâ€</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆåçš„æ–‡ä»¶åœ¨<code>~/.ssh</code>ç›®å½•å†…ï¼Œ<code>id_rsa</code>ä¸ºç§é’¥ï¼Œ<code>id_rsa.pub</code>ä¸ºå…¬é’¥ã€‚å°†å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹æœºå™¨å¯¹åº”ç”¨æˆ·çš„<code>~/.ssh/authorized_keys</code>å†…ã€‚</p><span id="more"></span><h3 id="è¿œç¨‹æœåŠ¡å™¨é…ç½®"><a href="#è¿œç¨‹æœåŠ¡å™¨é…ç½®" class="headerlink" title="è¿œç¨‹æœåŠ¡å™¨é…ç½®"></a>è¿œç¨‹æœåŠ¡å™¨é…ç½®</h3><p>ä¸ºä¿è¯è¿œç¨‹æœåŠ¡å™¨å®‰å…¨ï¼Œåˆ›å»ºérootç”¨æˆ·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adduser custom_user</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘æœåŠ¡å™¨sshæœåŠ¡é…ç½®æ–‡ä»¶<code>/etc/ssh/sshd_config</code>ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ç™»é™†ç«¯å£å·</span></span><br><span class="line">Port 2210</span><br><span class="line"><span class="comment"># ç¦æ­¢ root ç™»é™†</span></span><br><span class="line">PermitRootLogin no</span><br><span class="line"><span class="comment"># å…³é—­è¿œç¨‹å¯†ç ç™»é™†</span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line">UsePAM no</span><br></pre></td></tr></table></figure><p>é‡å¯sshæœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service ssh restart</span><br></pre></td></tr></table></figure><h3 id="æœ¬åœ°SSHé…ç½®"><a href="#æœ¬åœ°SSHé…ç½®" class="headerlink" title="æœ¬åœ°SSHé…ç½®"></a>æœ¬åœ°SSHé…ç½®</h3><p>sshçš„é…ç½®æ–‡ä»¶æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«å¯¹åº”å…¨å±€<code>/etc/ssh/ssh_config</code>ï¼Œå½“å‰ç”¨æˆ·<code>~/.ssh/config</code>ï¼Œä»¥ä¸‹é…ç½®åœ¨è¿™ä¸¤ä¸ªä¸­éƒ½æœ‰æ•ˆã€‚</p><h5 id="ä¿æŒè¿æ¥"><a href="#ä¿æŒè¿æ¥" class="headerlink" title="ä¿æŒè¿æ¥"></a>ä¿æŒè¿æ¥</h5><p>SSHè¿æ¥é•¿æ—¶é—´ä¸ä½¿ç”¨ï¼Œä¼šæ–­è¿ã€‚å¯ä»¥é€šè¿‡é…ç½®é—´éš”å‘serverå‘é€keep-aliveåŒ…ï¼Œä¿æŒè¿æ¥</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯30ç§’å‘é€ä¸€ä¸ªkeep-aliveåŒ…</span></span><br><span class="line">ServerAliveInterval 30</span><br><span class="line"><span class="comment"># å‘é€10æ¬¡éƒ½æ— å“åº”ï¼Œæ–­å¼€è¿æ¥</span></span><br><span class="line">ServerAliveCountMax 10</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨å¤šä¸ªkey"><a href="#ä½¿ç”¨å¤šä¸ªkey" class="headerlink" title="ä½¿ç”¨å¤šä¸ªkey"></a>ä½¿ç”¨å¤šä¸ªkey</h5><p>å¯ä»¥é’ˆå¯¹ä¸åŒserverè®¾ç½®ä¸åŒçš„keyï¼Œä¹Ÿå¯ä»¥é…ç½®å¤šä¸ªkeyè®©sshåˆ†åˆ«å°è¯•</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šå•ä¸ªserverçš„keyæ–‡ä»¶</span></span><br><span class="line">Host example.com</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa_other</span><br><span class="line">    </span><br><span class="line"><span class="comment"># é€šç”¨é…ç½®å¤šä¸ªkey</span></span><br><span class="line">Host *</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa_1</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa_2</span><br></pre></td></tr></table></figure><h5 id="å…±äº«è¿æ¥"><a href="#å…±äº«è¿æ¥" class="headerlink" title="å…±äº«è¿æ¥"></a>å…±äº«è¿æ¥</h5><p>åŒæ—¶æ‰“å¼€å¤šä¸ªåŒä¸€ä¸ªserverçš„è¿æ¥ï¼Œè¿æ¥é—´å¯ä»¥å¤ç”¨ï¼Œä¸ç”¨å†è¿›è¡Œè¿æ¥å»ºç«‹ï¼ŒåŠ å¿«è¿æ¥é€Ÿåº¦ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">    ControlMaster auto</span><br><span class="line">    ControlPath /tmp/ssh-connection-%h-%p-%r</span><br></pre></td></tr></table></figure><p>åœ¨ä¼šè¯ç»“æŸåï¼Œå¯ä»¥è®©masterè¿æ¥ç»§ç»­åœ¨åå°ä¿æŒä¸€æ®µæ—¶é—´ï¼ŒåŠ å¿«ä¸‹æ¬¡è¿æ¥é€Ÿåº¦ã€‚è¿™ä¸ªåœ¨gitæ‹‰å–æ¨é€ä»£ç æ—¶éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥åŠ å¿«æ¯æ¬¡çš„é€Ÿåº¦ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">    ControlPersist 4h</span><br></pre></td></tr></table></figure><h3 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h3><p><img src="/images/ssh_forward.png" alt="ssh-forward.drawio"></p><h5 id="æœ¬åœ°ç«¯å£è½¬å‘"><a href="#æœ¬åœ°ç«¯å£è½¬å‘" class="headerlink" title="æœ¬åœ°ç«¯å£è½¬å‘"></a>æœ¬åœ°ç«¯å£è½¬å‘</h5><p>å°†å‘é€åˆ°æœ¬åœ°ç«¯å£çš„è¯·æ±‚ï¼Œé€šè¿‡ä¸­é—´æœåŠ¡å™¨ï¼Œè½¬å‘åˆ°ç›®æ ‡ä¸»æœºç«¯å£ã€‚</p><p>ä¾‹å¦‚æƒ…å†µâ‘ ï¼Œserver3å¯ä»¥è¿æ¥åˆ°server1ï¼Œä¸èƒ½è®¿é—®server2ï¼Œä¸¤å°æœºå™¨server1ã€server2é—´å¯ä»¥é€šä¿¡ï¼›è¿™æ—¶åœ¨server3ä¸Šè®¾ç½®è½¬å‘ï¼Œé€šè¿‡ä¸­é—´æœåŠ¡å™¨server1ï¼Œå°†æœ¬åœ°çš„ç«¯å£è½¬å‘åˆ°server2ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -L [ç»‘å®šåœ°å€:]æœ¬åœ°ç«¯å£:ç›®æ ‡åœ°å€:ç›®æ ‡ç«¯å£ ä¸­é—´æœåŠ¡å™¨ä¿¡æ¯</span><br><span class="line">ssh -g -L [localhost:]8080:server2:80 root@server1</span><br></pre></td></tr></table></figure><p><code>-g</code>å‚æ•°å…è®¸è¿œç¨‹è¿æ¥ä½¿ç”¨æ­¤ç«¯å£è½¬å‘ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåªèƒ½server3é€šè¿‡localhost:portæ¥è¿›è¡Œè®¿é—®ã€‚</p><h5 id="è¿œç¨‹ç«¯å£è½¬å‘"><a href="#è¿œç¨‹ç«¯å£è½¬å‘" class="headerlink" title="è¿œç¨‹ç«¯å£è½¬å‘"></a>è¿œç¨‹ç«¯å£è½¬å‘</h5><p>å°†å‘é€åˆ°è¿œç¨‹ç«¯å£çš„è¯·æ±‚ï¼Œè½¬å‘åˆ°ç›®æ ‡ç«¯å£ã€‚</p><p>ä¾‹å¦‚æƒ…å†µâ‘¡ï¼Œserver1å¯ä»¥è¿æ¥server2ä¸server3ï¼Œserver3ä¸èƒ½è®¿é—®server2ï¼›è¿™æ—¶åœ¨server1ä¸Šè®¾ç½®è½¬å‘ï¼Œä½¿server3èƒ½å¤Ÿé€šè¿‡server1çš„ç«¯å£ï¼Œè®¿é—®server2çš„ç«¯å£ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -R [ç»‘å®šåœ°å€:]ç»‘å®šç«¯å£:ç›®æ ‡åœ°å€:ç›®æ ‡ç«¯å£ ç”¨æˆ·@ä¸»æœºåœ°å€</span><br><span class="line">ssh -R [localhost:]8080:server2:80 root@server3</span><br></pre></td></tr></table></figure><h5 id="åŠ¨æ€ç«¯å£è½¬å‘"><a href="#åŠ¨æ€ç«¯å£è½¬å‘" class="headerlink" title="åŠ¨æ€ç«¯å£è½¬å‘"></a>åŠ¨æ€ç«¯å£è½¬å‘</h5><p>å°†å‘é€åˆ°æœ¬åœ°ç«¯å£çš„è¯·æ±‚ï¼Œè½¬å‘æŒ‡å®šåœ°å€ï¼Œç›®æ ‡åœ°å€å’Œç«¯å£ç”±å‘èµ·çš„è¯·æ±‚å†³å®šã€‚</p><p>åœ¨å¼€å¯è½¬å‘åï¼Œsshå°†åœ¨æœ¬åœ°å»ºç«‹socketä»£ç†ï¼Œå°†å®¢æˆ·ç«¯çš„ä»£ç†è®¾ç½®æˆæœ¬åœ°ä»£ç†å³å¯ä½¿ç”¨ã€‚</p><p>ä¾‹å¦‚æƒ…å†µâ‘ ï¼Œè‹¥server3éœ€è¦è®¿é—®server2ä¸Šçš„å¤šä¸ªç«¯å£æœåŠ¡ï¼›è¿™æ—¶åœ¨server3ä¸Šè®¾ç½®åŠ¨æ€è½¬å‘ï¼Œç„¶åå°†éœ€è¦è½¬å‘å®¢æˆ·ç«¯çš„ä»£ç†è®¾ç½®æˆ<code>127.0.0.1:8080</code>å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -D [ç»‘å®šåœ°å€:]ç»‘å®šç«¯å£ ç”¨æˆ·@ä¸»æœºåœ°å€</span><br><span class="line">ssh -D [localhost:]8080 root@server1</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;å…å¯†ç™»å½•&quot;&gt;&lt;a href=&quot;#å…å¯†ç™»å½•&quot; class=&quot;headerlink&quot; title=&quot;å…å¯†ç™»å½•&quot;&gt;&lt;/a&gt;å…å¯†ç™»å½•&lt;/h3&gt;&lt;p&gt;åˆ›å»ºæœ¬åœ°å…¬ç§é’¥æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ssh-keygen -t rsa -b 4096 -C &amp;quot;youremail@example.comâ€&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;ç”Ÿæˆåçš„æ–‡ä»¶åœ¨&lt;code&gt;~/.ssh&lt;/code&gt;ç›®å½•å†…ï¼Œ&lt;code&gt;id_rsa&lt;/code&gt;ä¸ºç§é’¥ï¼Œ&lt;code&gt;id_rsa.pub&lt;/code&gt;ä¸ºå…¬é’¥ã€‚å°†å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹æœºå™¨å¯¹åº”ç”¨æˆ·çš„&lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt;å†…ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Linux" scheme="https://bootell.net/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªåŠ¨åŒ–ç¼–è¯‘ Hexo åšå®¢å¹¶éƒ¨ç½²åœ¨ Github Page</title>
    <link href="https://bootell.net/2019/10/03/Build-Hexo-Using-Github-Actions/"/>
    <id>https://bootell.net/2019/10/03/Build-Hexo-Using-Github-Actions/</id>
    <published>2019-10-03T12:00:00.000Z</published>
    <updated>2022-09-11T14:34:52.490Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ç›´ä½¿ç”¨ <a href="https://travis-ci.org/">Travis CI</a> æ¥è‡ªåŠ¨ç”Ÿæˆå’Œéƒ¨ç½² Hexoã€‚æœ€è¿‘ Github æ¨å‡ºäº†è‡ªå·±çš„æŒç»­é›†æˆæœåŠ¡ <a href="https://github.com/features/actions">Github Actions</a>ï¼Œäºæ˜¯æ”¹ç”¨å®ƒä»¥æ–¹ä¾¿ç®¡ç†ã€‚åœ¨æ­¤è®°å½•ä¸€ä¸‹ä¸¤ç§æ–¹æ³•ã€‚</p><span id="more"></span><h3 id="Hexo-é…ç½®"><a href="#Hexo-é…ç½®" class="headerlink" title="Hexo é…ç½®"></a>Hexo é…ç½®</h3><p>å°†ä¸»é¢˜æ–‡ä»¶ä½¿ç”¨ git submodule è·Ÿè¸ªï¼š<code>git submodule add https://github.com/hexojs/hexo-theme-landscape themes/landscape</code>ï¼›<br>å…ˆéšæ„æ¨é€ä¸€ä¸ªæäº¤åˆ°è¿œç«¯çš„ master åˆ†æ”¯è¿›è¡Œåˆå§‹åŒ–ï¼Œæºç æ–‡ä»¶ä¸è¦ä½¿ç”¨ master åˆ†æ”¯æäº¤åˆ°è¿œç«¯ï¼›</p><h3 id="ä½¿ç”¨-Github-Actions"><a href="#ä½¿ç”¨-Github-Actions" class="headerlink" title="ä½¿ç”¨ Github Actions"></a>ä½¿ç”¨ Github Actions</h3><p>ç›®å‰ä½¿ç”¨ <a href="https://github.com/features/actions">Github Actions</a> éœ€è¦ç”³è¯·ï¼Œç”³è¯·åä¼šåœ¨ Repo é‡Œå‡ºç° Actions çš„æ ‡ç­¾ã€‚<br>ä½¿ç”¨æ—¶ï¼Œç›´æ¥åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º <code>.github/workflow/deploy.yaml</code> å³å¯ï¼Œæ³¨æ„ä¿®æ”¹ git çš„ä¿¡æ¯ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">Deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span> [<span class="string">push</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@master</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">ref:</span> <span class="string">hexo</span></span><br><span class="line">        <span class="attr">submodules:</span> <span class="literal">true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">node-version:</span> <span class="string">&#x27;10.x&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Get</span> <span class="string">old</span> <span class="string">version</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        npx hexo clean</span></span><br><span class="line"><span class="string">        git clone &quot;https://github.com/$&#123;GITHUB_REPOSITORY&#125;&quot; -b master public</span></span><br><span class="line"><span class="string"></span>    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span> <span class="string">pages</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">npx</span> <span class="string">hexo</span> <span class="string">generate</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">to</span> <span class="string">GitHub</span> <span class="string">Page</span></span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">        <span class="attr">GITHUB_TOKEN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        cd $GITHUB_WORKSPACE/public</span></span><br><span class="line"><span class="string">        git config user.name $GITHUB_ACTOR</span></span><br><span class="line"><span class="string">        git add .</span></span><br><span class="line"><span class="string">        git commit -m &quot;github actions auto build&quot;</span></span><br><span class="line"><span class="string">        git push https://$&#123;GITHUB_ACTOR&#125;:$&#123;GITHUB_TOKEN&#125;@github.com/$&#123;GITHUB_REPOSITORY&#125;.git master:master</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-Travis-CI"><a href="#ä½¿ç”¨-Travis-CI" class="headerlink" title="ä½¿ç”¨ Travis CI"></a>ä½¿ç”¨ Travis CI</h3><p>é¦–å…ˆéœ€è¦åˆ›å»º <a href="https://github.com/settings/tokens">GitHub Token</a>ï¼Œç”¨äºæœ€åæ¨åˆ° <code>Github Pages</code>ï¼›ç„¶åç™»å½• <a href="https://travis-ci.org/">Travis CI</a> å¹¶æˆæƒåï¼Œåœ¨è®¾ç½®é‡Œæ·»åŠ å˜é‡ <code>GITHUB_TOKEN</code>ï¼Œå€¼ä¸ºä¸Šé¢åˆ›å»ºçš„ tokenã€‚<br>åœ¨æ ¹ç›®å½•ä¸‹æ·»åŠ  <code>.travis.yml</code> æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">node_js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">node_js:</span> <span class="string">stable</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">directories:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">node_modules</span></span><br><span class="line"></span><br><span class="line"><span class="attr">install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line"><span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">hexo</span> <span class="string">clean</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">clone</span> <span class="string">https://github.com/$&#123;TRAVIS_REPO_SLUG&#125;.git</span> <span class="string">-b</span> <span class="string">master</span> <span class="string">public/</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">hexo</span> <span class="string">generate</span></span><br><span class="line"></span><br><span class="line"><span class="attr">after_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cd</span> <span class="string">./public</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">checkout</span> <span class="string">master</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">user.name</span> <span class="string">&quot;Travis CI&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">add</span> <span class="string">.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">commit</span> <span class="string">-m</span> <span class="string">&quot;travis-ci auto build&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">push</span> <span class="string">&quot;https://$&#123;GITHUB_TOKEN&#125;@github.com/$&#123;TRAVIS_REPO_SLUG&#125;.git&quot;</span> <span class="string">master:master</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸€ç›´ä½¿ç”¨ &lt;a href=&quot;https://travis-ci.org/&quot;&gt;Travis CI&lt;/a&gt; æ¥è‡ªåŠ¨ç”Ÿæˆå’Œéƒ¨ç½² Hexoã€‚æœ€è¿‘ Github æ¨å‡ºäº†è‡ªå·±çš„æŒç»­é›†æˆæœåŠ¡ &lt;a href=&quot;https://github.com/features/actions&quot;&gt;Github Actions&lt;/a&gt;ï¼Œäºæ˜¯æ”¹ç”¨å®ƒä»¥æ–¹ä¾¿ç®¡ç†ã€‚åœ¨æ­¤è®°å½•ä¸€ä¸‹ä¸¤ç§æ–¹æ³•ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Blog" scheme="https://bootell.net/tags/Blog/"/>
    
  </entry>
  
  <entry>
    <title>Scrapy çˆ¬è™«å¼€å‘</title>
    <link href="https://bootell.net/2019/08/06/Scrapy-Development/"/>
    <id>https://bootell.net/2019/08/06/Scrapy-Development/</id>
    <published>2019-08-06T02:00:00.000Z</published>
    <updated>2022-09-11T14:34:52.494Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><p>Scrapy æ”¯æŒ Python2.7 åŠ 3.4+ï¼Œå®‰è£…æ­¥éª¤æŒ‰ç…§<a href="https://docs.scrapy.org/en/latest/intro/install.html">å®˜æ–¹æ–‡æ¡£</a>è¿›è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">pip3 install Scrapy</span><br><span class="line"><span class="comment"># åˆ›å»ºé¡¹ç›®</span></span><br><span class="line">scrapy startproject crawler</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæ¯•åï¼Œç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">crawler/</span><br><span class="line">    scrapy.cfg            # scrapyd-client é¡¹ç›®éƒ¨ç½²æ—¶ä½¿ç”¨</span><br><span class="line">    crawler/</span><br><span class="line">        __init__.py</span><br><span class="line">        items.py          # çˆ¬å–ç»“æœç»“æ„åŒ–</span><br><span class="line">        middlewares.py    # é¡¹ç›®ä¸­é—´ä»¶</span><br><span class="line">        pipelines.py      # é¡¹ç›®ç®¡é“</span><br><span class="line">        settings.py       # é¡¹ç›®è®¾ç½®</span><br><span class="line">        spiders/          # çˆ¬è™«æ‰€åœ¨ç›®å½•</span><br><span class="line">            __init__.py</span><br></pre></td></tr></table></figure><p>Scrapy æ‰§è¡Œæ—¶çš„æµç¨‹å¤§è‡´æ˜¯</p><p><img src="/images/scrapy_flow.png" alt="Scrapy æµç¨‹"></p><ol><li>Engine ä» Spider è·å– <code>start_urls</code></li><li>Engine å°† <code>start_urls</code> å‘é€åˆ° Schedulerï¼Œå¹¶è¯·æ±‚ä¸‹ä¸€ä¸ªçˆ¬å–çš„ Request</li><li>Scheduler å°†ä¸‹ä¸€ä¸ªè¦çˆ¬å– Request è¿”å›ç»™ Engine</li><li>Engine å°†æ”¶åˆ°çš„ Request æ‰§è¡Œæ‰€æœ‰ Middleware çš„ <code>process_request()</code> åï¼Œå‘é€åˆ° Downloader</li><li>Downloader ä¸‹è½½å†…å®¹åï¼Œæ‰§è¡Œæ‰€æœ‰ Middleware çš„ <code>process_response()</code> åï¼Œå°†ç»“æœè¿”å›ç»™ Engine</li><li>Engine å°†å†…å®¹å‘é€ç»™ Spider åšæ•°æ®å¤„ç†ï¼Œä¹‹å‰æ‰§è¡Œ Middleware çš„ <code>process_spider_input()</code></li><li>Spider å¤„ç†åï¼Œå°†ç»“æœé€šè¿‡ Middleware çš„ <code>process_spider_output()</code> åï¼Œè¿”å›ç»™ Engine</li><li>Engine å°†å¤„ç†åçš„æ•°æ®å‘é€ç»™ Pipline è¿›è¡Œæ“ä½œï¼Œå¹¶å°†å¤„ç†è¿‡çš„ Request å‘é€ç»™ Schedulerï¼Œè¯·æ±‚ä¸‹ä¸€ä¸ª Request</li></ol><p><code>settings.py</code> é…ç½®æ–‡ä»¶ä¸­ï¼Œä¸€èˆ¬éœ€è¦ä¿®æ”¹çš„é…ç½®å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¯å¦éµå¾ª robots åè®®</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span></span><br><span class="line"><span class="comment"># å¹¶å‘è¯·æ±‚æ•°</span></span><br><span class="line">CONCURRENT_REQUESTS = <span class="number">16</span></span><br><span class="line"><span class="comment"># ä¸‹è½½é—´éš”ï¼Œå®é™…èŒƒå›´åœ¨ 0.5*DOWNLOAD_DELAY åˆ° 1.5*DOWNLOAD_DELAY ä¹‹é—´</span></span><br><span class="line">DOWNLOAD_DELAY = <span class="number">1</span></span><br><span class="line"><span class="comment"># åŸŸå/IP å¹¶å‘è¯·æ±‚é™åˆ¶</span></span><br><span class="line">CONCURRENT_REQUESTS_PER_DOMAIN = <span class="number">16</span></span><br><span class="line">CONCURRENT_REQUESTS_PER_IP = <span class="number">16</span></span><br><span class="line"><span class="comment"># å¯ç”¨ Cookies</span></span><br><span class="line">COOKIES_ENABLED = <span class="literal">False</span></span><br><span class="line"><span class="comment"># ä¸‹è½½ä¸­é—´ä»¶ï¼Œåé¢æ•°å­—è¡¨ç¤ºä¼˜å…ˆçº§</span></span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;&#125;</span><br><span class="line"><span class="comment"># ç®¡é“</span></span><br><span class="line">ITEM_PIPELINES = &#123;&#125;</span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="Spider"><a href="#Spider" class="headerlink" title="Spider"></a>Spider</h3><p>æ¡†æ¶äº‹å…ˆå®šä¹‰äº†å‡ ä¸ªé€šç”¨çš„çˆ¬è™«</p><ul><li><code>scrapy.spiders.Spider</code> æœ€åŸºæœ¬çš„çˆ¬è™«</li><li><code>scrapy.spiders.CrawlSpider</code> æœ€å¸¸ç”¨çˆ¬è™«ï¼Œèƒ½æ ¹æ®è§„åˆ™å¯¹å…¨ç«™ç½‘ç«™è¿›è¡Œçˆ¬å–</li><li><code>scrapy.spiders.XMLFeedSpider</code></li><li><code>scrapy.spiders.CSVFeedSpider</code></li><li><code>scrapy.spiders.SitemapSpider</code></li></ul><p><code>CrawlSpider</code> ç»§æ‰¿äº† <code>Spider</code> å¤–ï¼Œæä¾›äº†é¢å¤–çš„å±æ€§å’Œæ–¹æ³•ï¼š</p><ul><li><code>rules</code>ï¼šæ˜¯ <code>Rule</code> å¯¹è±¡çš„åˆ—è¡¨ï¼Œå®šä¹‰äº†çˆ¬å–ç½‘ç«™çš„è§„åˆ™ã€‚å®ƒå¯¹ä¸åŒçš„è¿æ¥æ‰€éœ€è¦æ‰§è¡Œçš„åŠ¨ä½œè¿›è¡Œäº†å®šä¹‰ã€‚</li><li><code>parse_start_url()</code>ï¼š<code>start_url</code> çš„è¯·æ±‚è¿”å›æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨</li></ul><p><code>Rule</code> å¯¹è±¡ä¸»è¦ä½œç”¨ä¸ºè¿‡æ»¤æœ‰æ•ˆé“¾æ¥ï¼ŒæŒ‡å®šé“¾æ¥å¤„ç†æ–¹æ³•ï¼Œå¹¶ç¡®å®šæ˜¯å¦ç»§ç»­è·Ÿè¿›</p><ul><li><code>link_extractor</code> ä»çˆ¬å–çš„é¡µé¢ä¸­æå–æŒ‡å®šæ ¼å¼çš„é“¾æ¥ï¼Œç”Ÿæˆæ–°çš„ Request è¯·æ±‚ï¼Œè§„åˆ™æœ‰ <code>allow</code>ï¼Œ<code>deny</code> ç­‰ï¼Œè¯¦ç»†è§<a href="https://docs.scrapy.org/en/latest/topics/link-extractors.html#topics-link-extractors">å®˜æ–¹æ–‡æ¡£</a></li><li><code>callback</code> å¯¹æ ¼å¼åŒ¹é…çš„é¡µé¢æ‰§è¡Œå¯¹åº”çš„å¤„ç†æ–¹æ³•</li><li><code>cb_kwargs</code> å›æ‰å‡½æ•°çš„å‚æ•°</li><li><code>follow</code> æ˜¯å¦å¯¹é¡µé¢ä¸­çš„è¿æ¥ç»§ç»­è·Ÿè¿›ï¼Œå½“ <code>callback</code> ä¸º <code>None</code> æ—¶é»˜è®¤ä¸º <code>True</code>ï¼Œå…¶ä»–é»˜è®¤ä¸º <code>False</code></li><li><code>process_links</code> è¿‡æ»¤æå–çš„é“¾æ¥</li><li><code>process_request</code> å¯¹æŒ‡å®šé“¾æ¥ Request è¯·æ±‚è¿›è¡Œå¤„ç†</li></ul><p>å®Œæ•´ç¤ºä¾‹ <code>crawlwer/spiders/ithome.py</code> å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy.spiders <span class="keyword">import</span> CrawlSpider, Rule</span><br><span class="line"><span class="keyword">from</span> scrapy.linkextractors <span class="keyword">import</span> LinkExtractor</span><br><span class="line"><span class="keyword">from</span> ..items <span class="keyword">import</span> CrawlerItem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ithome</span>(<span class="title class_ inherited__">CrawlSpider</span>):</span><br><span class="line">    <span class="comment"># çˆ¬è™«åè‡£</span></span><br><span class="line">    name = <span class="string">&quot;ithome&quot;</span></span><br><span class="line">    <span class="comment"># å…è®¸çˆ¬å–çš„åŸŸå</span></span><br><span class="line">    allowed_domains = [</span><br><span class="line">        <span class="string">&#x27;ithome.com&#x27;</span>,</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment"># åˆå§‹é“¾æ¥</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;https://www.ithome.com&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># çˆ¬å–çš„è§„åˆ™</span></span><br><span class="line">    rules = (</span><br><span class="line">        Rule(LinkExtractor(allow=(<span class="string">&#x27;[0-9]+\.htm&#x27;</span>)), callback=<span class="string">&#x27;parse_article&#x27;</span>, follow=<span class="literal">True</span>),</span><br><span class="line">        Rule(LinkExtractor(allow=(<span class="string">&#x27;.*\.htm&#x27;</span>))),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_article</span>(<span class="params">self, response</span>):</span><br><span class="line">        self.logger.info(<span class="string">&#x27;Parsing url: %s&#x27;</span>, response.url)</span><br><span class="line">        item = CrawlerItem()</span><br><span class="line">        item[<span class="string">&#x27;url&#x27;</span>] = response.url</span><br><span class="line">        item[<span class="string">&#x27;title&#x27;</span>] = response.css(<span class="string">&#x27;.post_title h1::text&#x27;</span>).get()</span><br><span class="line">        content = response.css(<span class="string">&#x27;.post_content p ::text&#x27;</span>).getall()</span><br><span class="line">        item[<span class="string">&#x27;content&#x27;</span>] = <span class="string">&#x27;&#x27;</span>.join(content)</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure><h3 id="Items"><a href="#Items" class="headerlink" title="Items"></a>Items</h3><p>ç”¨æ¥å®šä¹‰ç»“æ„åŒ–çš„ç»“æœ<br>å®Œæ•´ç¤ºä¾‹ <code>crawler/items.py</code> å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CrawlerItem</span>(scrapy.Item):</span><br><span class="line">    url = scrapy.Field()</span><br><span class="line">    title = scrapy.Field()</span><br><span class="line">    content = scrapy.Field()</span><br><span class="line">    comments = scrapy.Field()</span><br></pre></td></tr></table></figure><h3 id="Middlewares"><a href="#Middlewares" class="headerlink" title="Middlewares"></a>Middlewares</h3><p>middleware ä¸»è¦ç”¨æ¥åœ¨ä¸‹è½½ï¼Œå¤„ç†çˆ¬è™«ç­‰å‰åï¼Œè¿›è¡Œç›¸å…³æ“ä½œã€‚<br>æœ¬æ¬¡ä¸»è¦ç”¨æ¥å¤„ç†åçˆ¬è™«ã€‚æœ€åŸºæœ¬åçˆ¬è™«ä¸€èˆ¬æ˜¯é€šè¿‡æµè§ˆå™¨çš„ UAï¼Œå®¢æˆ·ç«¯çš„ IPï¼Œä»¥åŠåŠ¨æ€åŠ è½½çš„ JS æ¥å®ç°ã€‚äºæ˜¯é’ˆå¯¹ä»¥ä¸Šæªæ–½ï¼Œåˆ†åˆ«è¿›è¡Œå¤„ç†ã€‚</p><ul><li><p>è¯·æ±‚ UA éšæœºä¸­é—´ä»¶<br>éœ€è¦å®‰è£… <code>pip3 install fake-useragent</code>ï¼Œå®ƒä» <code>useragentstring.com</code> å’Œ <code>w3schools.com</code> è·å–çœŸå®çš„æµè§ˆå™¨ useragentï¼Œå¹¶åœ¨æœ¬åœ°è¿›è¡Œç¼“å­˜<br>æœ€æ—©æ—¶ä»ç½‘ä¸Šæ‰¾äº†ä¸€äº› UAï¼Œåœ¨æœ¬åœ°åšäº†ä¸€ä¸ªéšæœºè·å–ï¼Œç»“æœç½‘ä¸Šçš„ UA å·²è¢«ç¿»çˆ¬è™«è¿‡æ»¤äº†ï¼Œä¸èƒ½ç»•è¿‡åçˆ¬æœºåˆ¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fake_useragent <span class="keyword">import</span> UserAgent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserAgentMiddleware</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.ua = UserAgent()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        request.headers.setdefault(<span class="string">&#x27;User-Agent&#x27;</span>, self.ua.random)</span><br></pre></td></tr></table></figure></li><li><p>éšæœºä»£ç†ä¸­é—´ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProxyMiddleware</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, from_url, proxy_pool_key</span>):</span><br><span class="line">        self.redis = redis.from_url(from_url)</span><br><span class="line">        self.proxy_pool_key = proxy_pool_key</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">from_crawler</span>(<span class="params">cls, crawler</span>):</span><br><span class="line">        <span class="keyword">return</span> cls(</span><br><span class="line">            from_url=crawler.settings.get(<span class="string">&#x27;REDIS_URL&#x27;</span>),</span><br><span class="line">            proxy_pool_key=crawler.settings.get(<span class="string">&#x27;PROXY_POOL_KEY&#x27;</span>),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        proxy = self.redis.srandmember(self.proxy_pool_key)</span><br><span class="line">        <span class="keyword">if</span> proxy:</span><br><span class="line">            proxy = proxy.decode()</span><br><span class="line">            spider.logger.info(<span class="string">&#x27;Using proxy: %s&#x27;</span>, proxy)</span><br><span class="line">            request.meta[<span class="string">&#x27;proxy&#x27;</span>] = proxy</span><br></pre></td></tr></table></figure></li></ul><blockquote><h4 id="ä»£ç†é…ç½®"><a href="#ä»£ç†é…ç½®" class="headerlink" title="ä»£ç†é…ç½®"></a>ä»£ç†é…ç½®</h4><p>æœåŠ¡å™¨æœ‰å¤šä¸ªIPï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://wiki.squid-cache.org/">squid</a> åˆ›å»º http ä»£ç†æœåŠ¡å™¨ï¼Œé€šè¿‡è®¾ç½®ä»£ç†ä¸åŒç«¯å£ä½¿ç”¨ä¸åŒçš„ IP åœ°å€ã€‚</p><p>å®‰è£…ç›´æ¥é€šè¿‡ <code>apt-get install squid</code> ï¼Œå®‰è£…å®Œæˆåä¿®æ”¹é…ç½®æ–‡ä»¶ <code>/etc/squid/squid.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># å®šä¹‰æƒé™è§„åˆ™åˆ—è¡¨</span><br><span class="line">acl port3128 localport 3128</span><br><span class="line">acl port3129 localport 3129</span><br><span class="line">acl port3130 localport 3130</span><br><span class="line">acl port3131 localport 3131</span><br><span class="line">acl port3132 localport 3132</span><br><span class="line">acl port3133 localport 3133</span><br><span class="line"></span><br><span class="line"># å®šä¹‰è®¿é—®æ§åˆ¶ï¼Œå…è®¸æ¥å…¥çš„åœ°å€</span><br><span class="line">http_access allow all</span><br><span class="line"></span><br><span class="line"># å®šä¹‰ç›‘å¬çš„ç«¯å£</span><br><span class="line">http_port 3128</span><br><span class="line">http_port 3129</span><br><span class="line">http_port 3130</span><br><span class="line">http_port 3131</span><br><span class="line">http_port 3132</span><br><span class="line">http_port 3133</span><br><span class="line"></span><br><span class="line"># å®šä¹‰è½¬å‘åœ°å€</span><br><span class="line">tcp_outgoing_address 172.16.0.106 port3128</span><br><span class="line">tcp_outgoing_address 172.16.0.107 port3129</span><br><span class="line">tcp_outgoing_address 172.16.0.108 port3130</span><br><span class="line">tcp_outgoing_address 172.16.0.109 port3131</span><br><span class="line">tcp_outgoing_address 172.16.0.110 port3132</span><br><span class="line">tcp_outgoing_address 172.16.0.248 port3133</span><br></pre></td></tr></table></figure></blockquote><ul><li>CloudFlare åçˆ¬è™«ï¼Œèµ·ä¸»è¦åçˆ¬æ–¹æ³•æ˜¯é€šè¿‡ JS ç”Ÿæˆæœ¬åœ° Cookieã€‚<br>å¯ä»¥é€šè¿‡ <a href="https://github.com/clemfromspace/scrapy-cloudflare-middleware">scrapy_cloudflare_middleware</a> è¿›è¡Œå¤„ç†ï¼Œç›´æ¥å®‰è£… <code>pip3 install scrapy_cloudflare_middleware</code></li></ul><p>å¯åŠ¨çš„ Middlewares éœ€è¦å†™å…¥ <code>settings.py</code> é…ç½®æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CloudFlare åçˆ¬éœ€è¦å¼€å¯ cookie</span></span><br><span class="line">COOKIES_ENABLED = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">    <span class="comment"># ç¦ç”¨ Scrapy è‡ªå¸¦çš„ UA Middleware</span></span><br><span class="line">    <span class="string">&#x27;scrapy.contrib.downloadermiddleware.useragent.UserAgentMiddleware&#x27;</span>: <span class="literal">None</span>, </span><br><span class="line">    <span class="string">&#x27;crawler.middlewares.UserAgentMiddleware&#x27;</span>: <span class="number">400</span>,</span><br><span class="line">    <span class="string">&#x27;crawler.middlewares.ProxyMiddleware&#x27;</span>: <span class="number">543</span>,</span><br><span class="line">    <span class="string">&#x27;scrapy_cloudflare_middleware.middlewares.CloudFlareMiddleware&#x27;</span>: <span class="number">560</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Piplines"><a href="#Piplines" class="headerlink" title="Piplines"></a>Piplines</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MongoPipeline</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    collection_name = <span class="string">&#x27;scrapy_items&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, mongo_uri, mongo_db</span>):</span><br><span class="line">        self.mongo_uri = mongo_uri</span><br><span class="line">        self.mongo_db = mongo_db</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">from_crawler</span>(<span class="params">cls, crawler</span>):</span><br><span class="line">        <span class="keyword">return</span> cls(</span><br><span class="line">            mongo_uri=crawler.settings.get(<span class="string">&#x27;MONGO_URI&#x27;</span>),</span><br><span class="line">            mongo_db=crawler.settings.get(<span class="string">&#x27;MONGO_DATABASE&#x27;</span>, <span class="string">&#x27;items&#x27;</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_spider</span>(<span class="params">self, spider</span>):</span><br><span class="line">        self.client = pymongo.MongoClient(self.mongo_uri)</span><br><span class="line">        self.db = self.client[self.mongo_db]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close_spider</span>(<span class="params">self, spider</span>):</span><br><span class="line">        self.client.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        self.db[self.collection_name].insert_one(<span class="built_in">dict</span>(item))</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure><p>åœ¨ <code>settings.py</code> é…ç½®ä¸­å¢åŠ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">    <span class="string">&#x27;crawler.pipelines.MongoPipeline&#x27;</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MONGO_URI=<span class="string">&#x27;mongodb://127.0.0.1:27017&#x27;</span></span><br><span class="line">MONGO_DATABASE = <span class="string">&#x27;items&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Distributed-crawling"><a href="#Distributed-crawling" class="headerlink" title="Distributed crawling"></a>Distributed crawling</h3><p>Scrapy Scheduler å’Œ Duplication Filter æœ¬èº«ä½¿ç”¨äº†æœ¬åœ°æ–‡ä»¶æ¥æ¥å­˜å‚¨ï¼Œä¸èƒ½è¿›è¡Œæ°´å¹³çš„æ‰©å±•ã€‚å¯ä»¥ä½¿ç”¨ <a href="https://github.com/rmax/scrapy-redis">Scrapy-Redis</a> æ¥å­˜æ”¾è¿™äº›æ•°æ®ï¼Œä½¿çˆ¬è™«èƒ½å¤Ÿæ–¹ä¾¿æ‰©å±•ï¼Œå¯ä»¥åˆ†å¸ƒå¼éƒ¨ç½²ã€‚</p><p>å®‰è£…é€šè¿‡ <code>pip3 install Scrapy-Redis</code>ï¼Œå®‰è£…åä¿®æ”¹ settings é…ç½®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SCHEDULER = <span class="string">&quot;scrapy_redis.scheduler.Scheduler&quot;</span></span><br><span class="line">DUPEFILTER_CLASS = <span class="string">&quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span></span><br><span class="line">SCHEDULER_PERSIST = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">REDIS_URL=<span class="string">&#x27;redis://:password@127.0.0.1:6379/0&#x27;</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ Spider ç»§æ‰¿ <code>scrapy_redis.spiders.RedisCrawlSpider</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scrapy_redis.spiders <span class="keyword">import</span> RedisCrawlSpider</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ithome</span>(<span class="title class_ inherited__">RedisCrawlSpider</span>):</span><br><span class="line">    <span class="comment"># start_urls = [&#x27;https://www.ithome.com&#x27;]</span></span><br></pre></td></tr></table></figure><p>ç”±äºä»»åŠ¡æ˜¯ä» redis ä¸­è¯»å–ï¼Œæ‰€ä»¥ <code>start_urls</code> éœ€è¦ç›´æ¥å­˜å…¥ redis <code>redis-cli lpush ithome:start_urls https://www.ithome.com</code></p><h3 id="Deploy"><a href="#Deploy" class="headerlink" title="Deploy"></a>Deploy</h3><p>åªè¿è¡Œå•ä¸ªçˆ¬è™«æ—¶ï¼Œç›´æ¥ä½¿ç”¨ <code>scrapy crawl spider-name</code> å‘½ä»¤æ¥è¿è¡Œï¼ŒæŒ‰ <code>Ctrl+C</code> æ¥åœæ­¢ã€‚</p><p>éƒ¨ç½²åˆ°æœåŠ¡å™¨æ‰§è¡Œæ—¶ï¼Œéœ€è¦æ‰§è¡Œå¤šä¸ªçˆ¬è™«ï¼Œå¯ä»¥é€šè¿‡ <code>scrapyd</code> æœåŠ¡è¿è¡Œã€ç›‘æ§ã€‚<br>é¦–å…ˆå®‰è£… <code>pip3 install scrapyd </code>ï¼Œç„¶ååœ¨é¡¹ç›®ç›®å½•åˆ›å»ºé…ç½®æ–‡ä»¶ <code>scrapyd.conf</code> å¦‚ä¸‹</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[scrapyd]</span></span><br><span class="line"><span class="attr">eggs_dir</span>    = eggs</span><br><span class="line"><span class="attr">logs_dir</span>    = logs</span><br><span class="line">items_dir   =</span><br><span class="line"><span class="comment"># æ—¥å¿—æœ€å¤§ä¿å­˜æ•°é‡</span></span><br><span class="line"><span class="attr">jobs_to_keep</span> = <span class="number">5</span></span><br><span class="line"><span class="attr">dbs_dir</span>     = dbs</span><br><span class="line"><span class="comment"># åŒæ—¶æ‰§è¡Œçš„æœ€å¤§çˆ¬è™«æ•°é‡ï¼Œè®¾ä¸º0æ—¶ï¼Œæœ€å¤§æ‰§è¡Œæ•°é‡ä¸º max_proc_per_cpu * cpu æ ¸å¿ƒæ•°</span></span><br><span class="line"><span class="attr">max_proc</span>    = <span class="number">0</span></span><br><span class="line"><span class="comment"># æ¯ä¸ª CPU æœ€å¤§åŒæ—¶æ‰§è¡Œçˆ¬è™«æ•°é‡</span></span><br><span class="line"><span class="attr">max_proc_per_cpu</span> = <span class="number">4</span></span><br><span class="line"><span class="comment"># çˆ¬è™«å†å²æœ€å¤§ä¿å­˜æ•°é‡</span></span><br><span class="line"><span class="attr">finished_to_keep</span> = <span class="number">100</span></span><br><span class="line"><span class="attr">poll_interval</span> = <span class="number">5.0</span></span><br><span class="line"><span class="attr">bind_address</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">http_port</span>   = <span class="number">6800</span></span><br><span class="line"><span class="attr">debug</span>       = <span class="literal">off</span></span><br><span class="line"><span class="attr">runner</span>      = scrapyd.runner</span><br><span class="line"><span class="attr">application</span> = scrapyd.app.application</span><br><span class="line"><span class="attr">launcher</span>    = scrapyd.launcher.Launcher</span><br><span class="line"><span class="attr">webroot</span>     = scrapyd.website.Root</span><br><span class="line"><span class="section">[services]</span></span><br><span class="line"><span class="attr">schedule.json</span>     = scrapyd.webservice.Schedule</span><br><span class="line"><span class="attr">cancel.json</span>       = scrapyd.webservice.Cancel</span><br><span class="line"><span class="attr">addversion.json</span>   = scrapyd.webservice.AddVersion</span><br><span class="line"><span class="attr">listprojects.json</span> = scrapyd.webservice.ListProjects</span><br><span class="line"><span class="attr">listversions.json</span> = scrapyd.webservice.ListVersions</span><br><span class="line"><span class="attr">listspiders.json</span>  = scrapyd.webservice.ListSpiders</span><br><span class="line"><span class="attr">delproject.json</span>   = scrapyd.webservice.DeleteProject</span><br><span class="line"><span class="attr">delversion.json</span>   = scrapyd.webservice.DeleteVersion</span><br><span class="line"><span class="attr">listjobs.json</span>     = scrapyd.webservice.ListJobs</span><br><span class="line"><span class="attr">daemonstatus.json</span> = scrapyd.webservice.DaemonStatus</span><br></pre></td></tr></table></figure><p>scrapyd æä¾›äº† API æ¥å£ç”¨æ¥æ§åˆ¶å’Œç›‘æ§çˆ¬è™«</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºå¯è¿è¡Œçš„æ‰€æœ‰çˆ¬è™«</span></span><br><span class="line">curl http://localhost:6800/listspiders.json\?project\=default</span><br><span class="line"><span class="comment"># æ‰§è¡Œçˆ¬è™«</span></span><br><span class="line">curl http://localhost:6800/schedule.json -d project=default -d spider=spider-name </span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡</span></span><br><span class="line">curl http://localhost:6800/listjobs.json?project=default</span><br><span class="line"><span class="comment"># å–æ¶ˆçˆ¬è™«</span></span><br><span class="line">curl http://localhost:6800/cancel.json -d project=default -d job=&#123;job-id&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤– scrapyd è¿˜æä¾›äº†ä¸€ä¸ª web ç•Œé¢æ–¹ä¾¿æŸ¥çœ‹ï¼Œç”±äº scrapyd æœ¬èº«æ²¡æœ‰æä¾›æˆæƒæœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ nginx åå‘ä»£ç†å¹¶è®¾ç½® Basic Authã€‚åˆ›å»º nginx é…ç½®æ–‡ä»¶ <code>/etc/nginx/sites-enabled/scrapyd</code> </p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">6801</span>;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:6800/;</span><br><span class="line">        <span class="attribute">auth_basic</span> <span class="string">&quot;Restricted&quot;</span>;</span><br><span class="line">        <span class="attribute">auth_basic_user_file</span> /etc/nginx/conf.d/.htpasswd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆå¯†ç æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -c /etc/nginx/conf.d/.htpasswd username password</span><br></pre></td></tr></table></figure><h3 id="Speed-optimization"><a href="#Speed-optimization" class="headerlink" title="Speed optimization"></a>Speed optimization</h3><p>æŒ‰ç…§é»˜è®¤é…ç½®éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¹‹åï¼Œå‘ç°æœåŠ¡å™¨è´Ÿè½½éå¸¸ä½ï¼Œçˆ¬å–é€Ÿåº¦ä¹Ÿå¾ˆæ…¢ã€‚å¯ä»¥ç®€å•çš„ä¿®æ”¹é…ç½®åŠ å¿«çˆ¬è™«é€Ÿåº¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CONCURRENT_REQUESTS = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">DOWNLOAD_DELAY = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">CONCURRENT_REQUESTS_PER_DOMAIN = <span class="number">100</span></span><br><span class="line">CONCURRENT_REQUESTS_PER_IP = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">REACTOR_THREADPOOL_MAXSIZE = <span class="number">20</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;Installation&quot;&gt;&lt;a href=&quot;#Installation&quot; class=&quot;headerlink&quot; title=&quot;Installation&quot;&gt;&lt;/a&gt;Installation&lt;/h3&gt;&lt;p&gt;Scrapy æ”¯æŒ Python2.7 åŠ 3.4+ï¼Œå®‰è£…æ­¥éª¤æŒ‰ç…§&lt;a href=&quot;https://docs.scrapy.org/en/latest/intro/install.html&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;è¿›è¡Œ&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å®‰è£…&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip3 install Scrapy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# åˆ›å»ºé¡¹ç›®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;scrapy startproject crawler&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;p&gt;å®‰è£…å®Œæ¯•åï¼Œç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤º&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;crawler/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    scrapy.cfg            # scrapyd-client é¡¹ç›®éƒ¨ç½²æ—¶ä½¿ç”¨&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    crawler/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        __init__.py&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        items.py          # çˆ¬å–ç»“æœç»“æ„åŒ–&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        middlewares.py    # é¡¹ç›®ä¸­é—´ä»¶&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        pipelines.py      # é¡¹ç›®ç®¡é“&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        settings.py       # é¡¹ç›®è®¾ç½®&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        spiders/          # çˆ¬è™«æ‰€åœ¨ç›®å½•&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            __init__.py&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;p&gt;Scrapy æ‰§è¡Œæ—¶çš„æµç¨‹å¤§è‡´æ˜¯&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/scrapy_flow.png&quot; alt=&quot;Scrapy æµç¨‹&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Engine ä» Spider è·å– &lt;code&gt;start_urls&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Engine å°† &lt;code&gt;start_urls&lt;/code&gt; å‘é€åˆ° Schedulerï¼Œå¹¶è¯·æ±‚ä¸‹ä¸€ä¸ªçˆ¬å–çš„ Request&lt;/li&gt;
&lt;li&gt;Scheduler å°†ä¸‹ä¸€ä¸ªè¦çˆ¬å– Request è¿”å›ç»™ Engine&lt;/li&gt;
&lt;li&gt;Engine å°†æ”¶åˆ°çš„ Request æ‰§è¡Œæ‰€æœ‰ Middleware çš„ &lt;code&gt;process_request()&lt;/code&gt; åï¼Œå‘é€åˆ° Downloader&lt;/li&gt;
&lt;li&gt;Downloader ä¸‹è½½å†…å®¹åï¼Œæ‰§è¡Œæ‰€æœ‰ Middleware çš„ &lt;code&gt;process_response()&lt;/code&gt; åï¼Œå°†ç»“æœè¿”å›ç»™ Engine&lt;/li&gt;
&lt;li&gt;Engine å°†å†…å®¹å‘é€ç»™ Spider åšæ•°æ®å¤„ç†ï¼Œä¹‹å‰æ‰§è¡Œ Middleware çš„ &lt;code&gt;process_spider_input()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Spider å¤„ç†åï¼Œå°†ç»“æœé€šè¿‡ Middleware çš„ &lt;code&gt;process_spider_output()&lt;/code&gt; åï¼Œè¿”å›ç»™ Engine&lt;/li&gt;
&lt;li&gt;Engine å°†å¤„ç†åçš„æ•°æ®å‘é€ç»™ Pipline è¿›è¡Œæ“ä½œï¼Œå¹¶å°†å¤„ç†è¿‡çš„ Request å‘é€ç»™ Schedulerï¼Œè¯·æ±‚ä¸‹ä¸€ä¸ª Request&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;settings.py&lt;/code&gt; é…ç½®æ–‡ä»¶ä¸­ï¼Œä¸€èˆ¬éœ€è¦ä¿®æ”¹çš„é…ç½®å¦‚ä¸‹&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# æ˜¯å¦éµå¾ª robots åè®®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ROBOTSTXT_OBEY = &lt;span class=&quot;literal&quot;&gt;False&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å¹¶å‘è¯·æ±‚æ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CONCURRENT_REQUESTS = &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ä¸‹è½½é—´éš”ï¼Œå®é™…èŒƒå›´åœ¨ 0.5*DOWNLOAD_DELAY åˆ° 1.5*DOWNLOAD_DELAY ä¹‹é—´&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DOWNLOAD_DELAY = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# åŸŸå/IP å¹¶å‘è¯·æ±‚é™åˆ¶&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CONCURRENT_REQUESTS_PER_DOMAIN = &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CONCURRENT_REQUESTS_PER_IP = &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# å¯ç”¨ Cookies&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;COOKIES_ENABLED = &lt;span class=&quot;literal&quot;&gt;False&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ä¸‹è½½ä¸­é—´ä»¶ï¼Œåé¢æ•°å­—è¡¨ç¤ºä¼˜å…ˆçº§&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DOWNLOADER_MIDDLEWARES = &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ç®¡é“&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ITEM_PIPELINES = &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="çˆ¬è™«" scheme="https://bootell.net/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªåŠ¨åŒ–ç¼–è¯‘ LEDE K3</title>
    <link href="https://bootell.net/2019/02/28/LEDE-K3-Build-with-GitLab-CI/"/>
    <id>https://bootell.net/2019/02/28/LEDE-K3-Build-with-GitLab-CI/</id>
    <published>2019-02-28T02:18:00.000Z</published>
    <updated>2019-10-10T02:08:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬åœ°ç¼–è¯‘ä¸€æ¬¡ LEDE&#x2F;OpenWrt å›ºä»¶èŠ±äº†è¿‘3ä¸ªå°æ—¶ï¼Œä¸‹è½½ä¾èµ–æ–‡ä»¶å› ä¸ºç½‘ç»œé—®é¢˜ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œè€ƒè™‘å¯ä»¥åˆ©ç”¨å„ç§å…è´¹çš„ CI è‡ªåŠ¨é›†æˆå·¥å…·æ¥ç¼–è¯‘éœ€è¦çš„å›ºä»¶ï¼Œç›®å‰å¯é€‰çš„æœ‰ Github Actions å’Œ GitLab CIã€‚</p><span id="more"></span><h3 id="ç¼–è¯‘é…ç½®"><a href="#ç¼–è¯‘é…ç½®" class="headerlink" title="ç¼–è¯‘é…ç½®"></a>ç¼–è¯‘é…ç½®</h3><h5 id="ç”Ÿæˆç¼–è¯‘é…ç½®æ–‡ä»¶"><a href="#ç”Ÿæˆç¼–è¯‘é…ç½®æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆç¼–è¯‘é…ç½®æ–‡ä»¶"></a>ç”Ÿæˆç¼–è¯‘é…ç½®æ–‡ä»¶</h5><p>ç¼–è¯‘ä½¿ç”¨ <a href="https://github.com/coolsnowwolf/lede">coolsnowwolf&#x2F;lede</a> é¡¹ç›®ï¼Œé¦–å…ˆå¯¹è¦ç¼–è¯‘çš„å›ºä»¶è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…‹éš†é¡¹ç›®</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/coolsnowwolf/lede.git</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> lede</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½è½¯ä»¶æº</span></span><br><span class="line">./scripts/feeds update -a</span><br><span class="line">./scripts/feeds install -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰æ‹©é…ç½®ï¼Œç”Ÿæˆé…ç½®æ–‡ä»¶</span></span><br><span class="line">make menuconfig</span><br></pre></td></tr></table></figure><h5 id="å›ºåŒ–åŸå›ºä»¶é…ç½®"><a href="#å›ºåŒ–åŸå›ºä»¶é…ç½®" class="headerlink" title="å›ºåŒ–åŸå›ºä»¶é…ç½®"></a>å›ºåŒ–åŸå›ºä»¶é…ç½®</h5><p>å°†éœ€è¦åŸå›ºä»¶éœ€è¦ä¿å­˜çš„æ–‡ä»¶ï¼Œæ·»åŠ åˆ°ç¼–è¯‘ç›®å½•çš„ <code>/files</code> å†…ï¼Œå³å¯ä¿å­˜ä¹‹å‰å›ºä»¶çš„é…ç½®ã€‚<br>å¸¸è§çš„é…ç½®åœ°å€å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/</span><br><span class="line">â””â”€â”€ etc</span><br><span class="line">    â”œâ”€â”€ config</span><br><span class="line"> Â Â  â”‚Â Â  â”œâ”€â”€ system    ä¸»æœºåï¼Œæ—¶åŒºç­‰</span><br><span class="line"> Â Â  â”‚Â Â  â”œâ”€â”€ network   ç½‘ç»œ</span><br><span class="line"> Â Â  â”‚Â Â  â”œâ”€â”€ dhcp</span><br><span class="line"> Â Â  â”‚Â Â  â””â”€â”€ ddns</span><br><span class="line"> Â Â  â””â”€â”€ lib\lua\luci\view\admin_status\index.htm  ä¸»é¡µæ ·å¼</span><br></pre></td></tr></table></figure><h3 id="è‡ªåŠ¨åŒ–ç¼–è¯‘"><a href="#è‡ªåŠ¨åŒ–ç¼–è¯‘" class="headerlink" title="è‡ªåŠ¨åŒ–ç¼–è¯‘"></a>è‡ªåŠ¨åŒ–ç¼–è¯‘</h3><p>è‡ªåŠ¨åŒ–ç¼–è¯‘éœ€è¦å…ˆé…ç½®å¥½é…ç½®æ–‡ä»¶ï¼ŒæŠŠ <code>make menuconfig</code> ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ä¿å­˜ä¸º <code>defconfig</code>ï¼Œä¸€å¹¶æäº¤åˆ°è¿œç¨‹ä»“åº“ã€‚</p><h5 id="GitHub-Actions"><a href="#GitHub-Actions" class="headerlink" title="GitHub Actions"></a>GitHub Actions</h5><p><a href="https://github.com/features/actions">Github Actions</a> å…è´¹è´¦æˆ·æ¯æœˆæœ‰2000åˆ†é’Ÿæ—¶é•¿ï¼Œå•æ¬¡æœ€é«˜è¿è¡Œ6å°æ—¶ï¼Œéå¸¸å……è¶³ã€‚ç›®å‰æµ‹è¯•é˜¶æ®µéœ€è¦ç”³è¯·å¼€é€šã€‚<br>ç¼–è¯‘éœ€è¦æ·»åŠ é…ç½®æ–‡ä»¶ <code>.github/workflow/build.yaml</code>:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span> [<span class="string">push</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">k3:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-16.04</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@master</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">Environment</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          sudo apt-get -yqq update</span></span><br><span class="line"><span class="string">          sudo apt-get -yqq install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs git-core gcc-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Prepare</span> <span class="string">Build</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          ./scripts/feeds update -a</span></span><br><span class="line"><span class="string">          ./scripts/feeds install -a</span></span><br><span class="line"><span class="string">          cp k3config .config</span></span><br><span class="line"><span class="string">          make defconfig</span></span><br><span class="line"><span class="string">          sed -i &#x27;s|^TARGET_|# TARGET_|g; s|# TARGET_DEVICES += phicomm-k3|TARGET_DEVICES += phicomm-k3|&#x27; target/linux/bcm53xx/image/Makefile</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">Image</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">make</span> <span class="string">-j$(nproc)</span> <span class="string">V=sc</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Upload</span> <span class="string">Image</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/upload-artifact@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">lede-k3-$&#123;&#123;</span> <span class="string">github.sha</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">bin</span></span><br></pre></td></tr></table></figure><h5 id="GitLab-CI"><a href="#GitLab-CI" class="headerlink" title="GitLab CI"></a>GitLab CI</h5><p>GitLab CI çš„ Shared Runners æ¯ä¸ª Job çš„æ—¶é—´é™åˆ¶ä¸º3å°æ—¶ï¼Œæ¯æœˆæœ‰2000åˆ†é’Ÿçš„å…è´¹ç¼–è¯‘æ—¶é•¿ï¼Œè¶³å¤Ÿæ—¥å¸¸ç¼–è¯‘è‡ªå·±çš„å›ºä»¶äº†ã€‚<br>ç¼–è¯‘éœ€è¦åœ¨ GitLab åå° Setting&#x2F;CI&#x2F;General ä¸­è®¾ç½® <code>Timeout</code> æ—¶é—´ä¸º <code>3h</code>ï¼Œå¹¶æ·»åŠ é…ç½®æ–‡ä»¶ <code>.gitlab-ci.yml</code> å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">image:</span> <span class="string">tossp/lede:latest</span></span><br><span class="line"></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">make:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">variables:</span></span><br><span class="line">    <span class="attr">GIT_SUBMODULE_STRATEGY:</span> <span class="string">recursive</span></span><br><span class="line">    <span class="attr">FORCE_UNSAFE_CONFIGURE:</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">key:</span> <span class="string">&quot;$CI_JOB_NAME-$CI_COMMIT_REF_SLUG&quot;</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dl/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">feeds/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">staging_dir/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">build_dir/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">key-*</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">&quot;$&#123;CI_JOB_STAGE&#125;_$&#123;CI_JOB_NAME&#125;_$&#123;CI_COMMIT_REF_NAME&#125;&quot;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">always</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">bin/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">build.log</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./scripts/feeds</span> <span class="string">update</span> <span class="string">-a</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./scripts/feeds</span> <span class="string">install</span> <span class="string">-a</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cp</span> <span class="string">defconfig</span> <span class="string">.config</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">make</span> <span class="string">defconfig</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sed</span> <span class="string">-i</span> <span class="string">&#x27;s|^TARGET_|# TARGET_|g; s|# TARGET_DEVICES += phicomm-k3|TARGET_DEVICES += phicomm-k3|&#x27;</span> <span class="string">target/linux/bcm53xx/image/Makefile</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">make</span> <span class="string">-j$(nproc)</span> <span class="string">V=sc</span> <span class="string">&gt;</span> <span class="string">./build.log</span> <span class="number">2</span><span class="string">&gt;&amp;1</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ci</span></span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h3><ul><li><p>åŸå›ºä»¶ä¸ºLEDEæ—¶å‡çº§<br>å°†å›ºä»¶ä¼ è¾“åˆ°è·¯ç”±å™¨ <code>/tmp/</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mtd -r write /tmp/openwrt-bcm53xx-phicomm-k3-squashfs.trx firmware</span><br></pre></td></tr></table></figure></li><li><p>å¼€å¯éšè—åŠŸèƒ½ï¼ˆssrï¼‰ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 0xDEADBEEF &gt; /etc/config/google_fu_mode</span><br></pre></td></tr></table></figure></li><li><p>æ— çº¿é©±åŠ¨<br>å¯ä»¥æ›´æ¢ K3 çš„æ— çº¿é©±åŠ¨ï¼Œç›´æ¥æ›¿æ¢æ–‡ä»¶å³å¯<br>é©±åŠ¨ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/Hill-98/phicommk3-firmware">https://github.com/Hill-98/phicommk3-firmware</a><br>é©±åŠ¨æºç åŒ…ä½ç½®ï¼š<code>/package/lean/k3-brcmfmac4366c-firmware/files/lib/firmware/brcm/brcmfmac4366c-pcie.bin</code><br>é©±åŠ¨å›ºä»¶ä½ç½®ï¼š<code>/lib/firmware/brcm/brcmfmac4366c-pcie.bin</code></p></li><li><p>mwan3 ipset<br>ä½¿ç”¨ mwan3 çš„ ipset åŠŸèƒ½ï¼Œå¯ä»¥å¯¹åŸŸåè¿›è¡ŒåŒ¹é…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;ipset create baidu hash:ip family inet&#x27;</span> &gt;&gt;Â /etc/rc.local</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;conf-dir=/etc/dnsmasq.d&#x27;</span> &gt;&gt; /etc/dnsmasq.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;ipset=/baidu.com/baidu&#x27;</span> &gt;&gt;Â /etc/dnsmasq.d/baidu.conf</span><br></pre></td></tr></table></figure></li></ul><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://www.right.com.cn/forum/thread-257677-1-1.html">https://www.right.com.cn/forum/thread-257677-1-1.html</a><br><a href="https://www.right.com.cn/forum/thread-419328-1-1.html">https://www.right.com.cn/forum/thread-419328-1-1.html</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬åœ°ç¼–è¯‘ä¸€æ¬¡ LEDE&amp;#x2F;OpenWrt å›ºä»¶èŠ±äº†è¿‘3ä¸ªå°æ—¶ï¼Œä¸‹è½½ä¾èµ–æ–‡ä»¶å› ä¸ºç½‘ç»œé—®é¢˜ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œè€ƒè™‘å¯ä»¥åˆ©ç”¨å„ç§å…è´¹çš„ CI è‡ªåŠ¨é›†æˆå·¥å…·æ¥ç¼–è¯‘éœ€è¦çš„å›ºä»¶ï¼Œç›®å‰å¯é€‰çš„æœ‰ Github Actions å’Œ GitLab CIã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="è·¯ç”±å™¨" scheme="https://bootell.net/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>Paypal å®ç°è‡ªåŠ¨è®¢é˜…</title>
    <link href="https://bootell.net/2018/08/30/Paypay-Subscriptions-Integrate/"/>
    <id>https://bootell.net/2018/08/30/Paypay-Subscriptions-Integrate/</id>
    <published>2018-08-30T08:30:00.000Z</published>
    <updated>2022-09-11T14:34:52.490Z</updated>
    
    <content type="html"><![CDATA[<p>å®˜æ–¹ç»™å‡ºçš„è‡ªåŠ¨ç»­è´¹åˆ†äº”æ­¥ <a href="https://developer.paypal.com/docs/subscriptions/integrate/integrate-steps/">Intergrate Subscriptions</a>ã€‚å®é™…å¼€å‘ä¸­ï¼Œè¿˜éœ€è¦å®ç°æ”¯ä»˜ç»“æœå¤„ç†å’Œè®¢é˜…ç®¡ç†ç­‰ï¼š</p><ol><li>äº‹å…ˆåˆ›å»ºè®¡åˆ’ï¼Œå¹¶æ¿€æ´»ï¼›</li><li>ç”¨æˆ·åˆ›å»ºè®¢é˜…ï¼Œè·³è½¬åˆ°paypalç½‘ç«™ç­‰å¾…ç”¨æˆ·åŒæ„ï¼›</li><li>ç”¨æˆ·åŒæ„åï¼Œè·³è½¬å›ç½‘ç«™ï¼Œæ‰§è¡Œè®¢é˜…ï¼›</li><li>è·å–ç”¨æˆ·è´¦å•ï¼ŒåŒ…æ‹¬æ¯æ¬¡æ‰£æ¬¾ç»“æœé€šçŸ¥çš„æ¥æ”¶æˆ–æ”¯ä»˜ç»“æœçš„ä¸»åŠ¨æŸ¥è¯¢ï¼›</li><li>å¤„ç†ç”¨æˆ·å–æ¶ˆè®¢é˜…ç­‰é€šçŸ¥ã€‚</li></ol><span id="more"></span><h3 id="ä½¿ç”¨-Palpal-SDK"><a href="#ä½¿ç”¨-Palpal-SDK" class="headerlink" title="ä½¿ç”¨ Palpal SDK"></a>ä½¿ç”¨ Palpal SDK</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer <span class="keyword">require</span> paypal/rest-api-sdk-php</span><br></pre></td></tr></table></figure><p>å®˜æ–¹æœ‰å®Œæ•´çš„ <a href="https://paypal.github.io/PayPal-PHP-SDK/sample/#billing">Samples</a>ï¼›</p><p>å¯ä»¥é€šè¿‡ <a href="https://www.sandbox.paypal.com/">Paypal Sandbox</a> æ–¹ä¾¿çš„è¿›è¡Œè°ƒè¯•ã€‚</p><h3 id="åˆ›å»ºè®¢é˜…è®¡åˆ’å¹¶æ¿€æ´»"><a href="#åˆ›å»ºè®¢é˜…è®¡åˆ’å¹¶æ¿€æ´»" class="headerlink" title="åˆ›å»ºè®¢é˜…è®¡åˆ’å¹¶æ¿€æ´»"></a>åˆ›å»ºè®¢é˜…è®¡åˆ’å¹¶æ¿€æ´»</h3><ul><li>è®¢é˜…è®¡åˆ’ï¼ˆBilling Planï¼‰ç­‰åŒäºçš„äº§å“ï¼Œéœ€è¦ä¸ºæ¯ä¸ªå•†å“ä¸åŒä»·æ ¼åˆ›å»ºä¸åŒçš„è®¡åˆ’ã€‚ä¸è¿‡å¯ä»¥é’ˆå¯¹ä¸åŒç”¨æˆ·åœ¨åˆ›å»ºåè®®æ—¶æ›´æ”¹ï¼›</li><li>Payment ä¸­åˆ›å»º <code>TRIAL</code> ç±»å‹æ”¯ä»˜æ—¶ï¼Œä¹Ÿå¿…é¡»å­˜åœ¨ <code>REGULAR</code> çš„æ”¯ä»˜ã€‚<code>TRAIL</code> å¹¶ä¸èƒ½è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦ä¸ºæ–°ç”¨æˆ·ç­‰æ¡ä»¶ï¼Œæ‰€ä»¥æ–°ç”¨æˆ·é¦–æ¬¡çš„ä¼˜æƒ éœ€è¦ä¸šåŠ¡ä»£ç è‡ªå·±å®ç°ã€‚</li><li>ç”±äºåˆ›å»ºç”¨æˆ·è®¢é˜…åè®®æ—¶ï¼Œ<strong>åè®®ç”Ÿæ•ˆæ—¶é—´å¿…é¡»åœ¨å½“å‰æ—¶é—´24å°æ—¶ä»¥å</strong>ï¼Œæ‰€ä»¥å¾ªç¯æ‰£æ¬¾çš„è®¾ç½®æ— æ³•ç«‹åˆ»æ‰£æ¬¾ï¼Œæœ€æ—©ä¹Ÿéœ€è¦24å°æ—¶ã€‚ä¸€èˆ¬ä¸šåŠ¡éœ€è¦ç«‹åˆ»è¿›è¡Œé¦–æ¬¡æ‰£æ¬¾ï¼Œå¯ä»¥ç”¨ <code>MerchantPreferences</code> çš„ <code>setSetupFee</code> æ¥è®¾ç½®é¦–æ¬¡æ‰£æ¬¾çš„è´¹ç”¨ï¼›</li><li>Paypal SDK ä¼šæŠ¥é”™ <code>&quot;NotifyUrl&quot; value is NULL</code>ï¼Œè¯¥é”™è¯¯ä¸º Paypal æœåŠ¡ç«¯é”™è¯¯ï¼Œä½†å®˜æ–¹æœªä¿®å¤ï¼Œè§£å†³åŠæ³•è§ <a href="https://github.com/paypal/PayPal-PHP-SDK/pull/1152/files">issue</a>ã€‚</li></ul><h3 id="åˆ›å»ºè®¢é˜…"><a href="#åˆ›å»ºè®¢é˜…" class="headerlink" title="åˆ›å»ºè®¢é˜…"></a>åˆ›å»ºè®¢é˜…</h3><ul><li><p>ç”¨æˆ·å¯ä»¥åˆ›å»ºé’ˆå¯¹åŒä¸€è®¢é˜…è®¡åˆ’çš„å¤šä¸ªè®¢é˜…åè®®ï¼ˆBilling Agreementï¼‰ï¼Œåˆ›å»ºåè·³è½¬è‡³ Paypal ç½‘ç«™ç­‰å¾…ç”¨æˆ·åŒæ„åè®®ï¼›</p></li><li><p>å› åè®®å¼€å§‹æ—¶é—´ <code>start_date</code> æœ€æ—©ä¸ºå½“å‰æ—¶é—´24å°æ—¶ä¹‹åï¼Œæ‰€ä»¥è¯¥å€¼å®é™…ä¸Šè®¾ç½®çš„æ˜¯ç¬¬äºŒæ¬¡æ‰£æ¬¾æ—¶é—´ã€‚æ‰€ä»¥ï¼Œè‹¥è®¾ç½®æŒ‰æœˆä»˜æ¬¾ï¼Œ<code>start_date</code> éœ€è¦è®¾ç½®æˆä¸€ä¸ªæœˆä»¥åï¼Œç„¶åé€šè¿‡è®¾ç½® <code>setSetupFee</code> ä»·æ ¼æ¥è®¾ç½®é¦–æ¬¡æ‰£æ¬¾è´¹ç”¨ï¼›</p></li><li><p>åˆ›å»ºè®¢é˜…åï¼Œè¿˜æ²¡æœ‰ç”Ÿæˆ <code>Agreement.id</code>ï¼Œè¿™æ—¶å€™éœ€è¦ä»è·³è½¬é“¾æ¥ä¸­æå–å‡º <code>token</code> æ¥ä½¿åˆ›å»ºçš„è®¢é˜…ä¸ç”¨æˆ·åŒæ„åè·³è½¬çš„å›æ¥çš„åè®®ä¿¡æ¯ç›¸å¯¹åº”ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$link</span> = <span class="variable">$agreement</span>-&gt;<span class="title function_ invoke__">getApprovalLink</span>();</span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="title function_ invoke__">parse_url</span>(<span class="variable">$link</span>, PHP_URL_QUERY), <span class="variable">$params</span>);</span><br><span class="line"><span class="variable">$token</span> = <span class="variable">$params</span>[<span class="string">&#x27;token&#x27;</span>];</span><br></pre></td></tr></table></figure></li></ul><h3 id="æ‰§è¡Œè®¢é˜…"><a href="#æ‰§è¡Œè®¢é˜…" class="headerlink" title="æ‰§è¡Œè®¢é˜…"></a>æ‰§è¡Œè®¢é˜…</h3><ul><li>åŒä¸€ä¸ªè®¢é˜…è®¡åˆ’å¯ä»¥è¢«åŒä¸€ä¸ªç”¨æˆ·å¤šæ¬¡è®¢é˜…ã€‚æ‰€ä»¥æ ¹æ®éœ€è¦ï¼Œéœ€è¦åœ¨æ‰§è¡Œæ–°åè®®æ—¶ï¼Œæ‰‹åŠ¨å–æ¶ˆè¯¥ç”¨æˆ·ä¹‹å‰çš„åè®®ï¼›</li><li>å®é™…æ‰£æ¬¾æ—¶é—´æœ‰å»¶è¿Ÿï¼Œæ¯æ¬¡å¾ªç¯æ‰£æ¬¾æ‰§è¡Œçš„æ—¶é—´ï¼Œéƒ½ä¼šæ¯”<code>AgreementDetail.next</code>æ˜¾ç¤ºçš„æ—¶é—´æ™šå‡ ä¸ªå°æ—¶ã€‚æ‰€ä»¥ä¸ºä¿è¯è¿ç»­æ€§ï¼Œå¯ä»¥è®¾ç½®æå‰ä¸€å¤©æ‰£æ¬¾ã€‚</li></ul><h3 id="æ”¯ä»˜ç»“æœæ¥æ”¶ä¸æŸ¥è¯¢"><a href="#æ”¯ä»˜ç»“æœæ¥æ”¶ä¸æŸ¥è¯¢" class="headerlink" title="æ”¯ä»˜ç»“æœæ¥æ”¶ä¸æŸ¥è¯¢"></a>æ”¯ä»˜ç»“æœæ¥æ”¶ä¸æŸ¥è¯¢</h3><ul><li>å¯ä»¥åœ¨ <code>My Apps -&gt; REST API apps -&gt; WEBHOOKS</code> è®¾ç½® <code>webhook</code> é€šçŸ¥ã€‚å½“æ¯æ¬¡å¾ªç¯æ‰£æ¬¾æˆåŠŸæ—¶ï¼ŒPaypal éƒ½ä¼šå‘é€ <code>PAYMENT.SALE.COMPLETED</code> çš„äº‹ä»¶é€šçŸ¥ï¼Œå¯ä»¥é€šè¿‡å…¶ä¸­çš„ <code>billing_agreement_id</code> å­—æ®µä¸å·²åˆ›å»ºçš„è®¢é˜…ç›¸åŒ¹é…ï¼Œæ‰¾å‡ºå¯¹åº”ä»˜æ¬¾çš„åè®®ã€‚</li><li>æ¯æ¬¡ <code>AgreementDetail</code> éƒ½ä¼šè¿”å›ä¸‹æ¬¡æ”¶æ¬¾æ—¶é—´ <code>next</code> å‚æ•°ã€‚å¯ä»¥åœ¨è¶…è¿‡è¿™ä¸ªæ—¶é—´åï¼Œé€šè¿‡ <code>Agreement::searchTransactions</code> æ–¹æ³•æŸ¥è¯¢è¯¥åè®®çš„æ‰€æœ‰äº¤æ˜“ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPaypal å®é™…çš„æ‰£æ¬¾æ—¶é—´ä¸€èˆ¬éƒ½ä¼šå»¶è¿Ÿï¼Œæ‰€ä»¥éœ€è¦å¤šæ¬¡é‡è¯•ã€‚</li></ul><h3 id="ç”¨æˆ·è®¢é˜…å–æ¶ˆä¸åˆ é™¤ç­‰"><a href="#ç”¨æˆ·è®¢é˜…å–æ¶ˆä¸åˆ é™¤ç­‰" class="headerlink" title="ç”¨æˆ·è®¢é˜…å–æ¶ˆä¸åˆ é™¤ç­‰"></a>ç”¨æˆ·è®¢é˜…å–æ¶ˆä¸åˆ é™¤ç­‰</h3><ul><li>å–æ¶ˆè®¢é˜…ä¼šé€šè¿‡ <code>webhook</code> å‘é€ <code>BILLING.SUBSCRIPTION.CANCELLED</code> é€šçŸ¥ï¼Œè®¢é˜…æš‚åœä¼šå‘é€ <code>BILLING.SUBSCRIPTION.SUSPENDED</code> é€šçŸ¥</li><li>ç›´æ¥åˆ é™¤è®¡åˆ’å¹¶ä¸ä¼šè‡ªåŠ¨åˆ é™¤åŸºäºè¯¥è®¡åˆ’çš„åè®®ï¼Œæ‰€ä»¥å†åˆ é™¤è®¡åˆ’å‰ï¼Œéœ€è¦æ‰‹åŠ¨å–æ¶ˆæ‰€æœ‰è®¢é˜…è¯¥è®¡åˆ’çš„åè®®ã€‚</li></ul><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://developer.paypal.com/docs/subscriptions/">https://developer.paypal.com/docs/subscriptions/</a></p><p><a href="https://paypal.github.io/PayPal-PHP-SDK/sample/">https://paypal.github.io/PayPal-PHP-SDK/sample/</a></p><p><a href="https://www.cnblogs.com/pheye/p/6603126.html">https://www.cnblogs.com/pheye/p/6603126.html</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å®˜æ–¹ç»™å‡ºçš„è‡ªåŠ¨ç»­è´¹åˆ†äº”æ­¥ &lt;a href=&quot;https://developer.paypal.com/docs/subscriptions/integrate/integrate-steps/&quot;&gt;Intergrate Subscriptions&lt;/a&gt;ã€‚å®é™…å¼€å‘ä¸­ï¼Œè¿˜éœ€è¦å®ç°æ”¯ä»˜ç»“æœå¤„ç†å’Œè®¢é˜…ç®¡ç†ç­‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;äº‹å…ˆåˆ›å»ºè®¡åˆ’ï¼Œå¹¶æ¿€æ´»ï¼›&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·åˆ›å»ºè®¢é˜…ï¼Œè·³è½¬åˆ°paypalç½‘ç«™ç­‰å¾…ç”¨æˆ·åŒæ„ï¼›&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·åŒæ„åï¼Œè·³è½¬å›ç½‘ç«™ï¼Œæ‰§è¡Œè®¢é˜…ï¼›&lt;/li&gt;
&lt;li&gt;è·å–ç”¨æˆ·è´¦å•ï¼ŒåŒ…æ‹¬æ¯æ¬¡æ‰£æ¬¾ç»“æœé€šçŸ¥çš„æ¥æ”¶æˆ–æ”¯ä»˜ç»“æœçš„ä¸»åŠ¨æŸ¥è¯¢ï¼›&lt;/li&gt;
&lt;li&gt;å¤„ç†ç”¨æˆ·å–æ¶ˆè®¢é˜…ç­‰é€šçŸ¥ã€‚&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    
    <category term="PHP" scheme="https://bootell.net/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://bootell.net/2016/02/01/Hello-World/"/>
    <id>https://bootell.net/2016/02/01/Hello-World/</id>
    <published>2016-02-01T04:00:00.000Z</published>
    <updated>2022-09-11T14:34:52.490Z</updated>
    
    <content type="html"><![CDATA[<p>2016, ä»æ ¡å›­åˆ°ç¤¾ä¼š, ä»æ¥æ”¶å­¦ä¹ åˆ°å‘å‡ºå£°éŸ³.</p><p>è®°å½•ç§¯ç´¯, åœ¨è¿™é‡Œ, boot to tell.</p><span id="more"></span>]]></content>
    
    
    <summary type="html">&lt;p&gt;2016, ä»æ ¡å›­åˆ°ç¤¾ä¼š, ä»æ¥æ”¶å­¦ä¹ åˆ°å‘å‡ºå£°éŸ³.&lt;/p&gt;
&lt;p&gt;è®°å½•ç§¯ç´¯, åœ¨è¿™é‡Œ, boot to tell.&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
</feed>
